こんにちはザディープダイブへようこそさてえーと今回のテーマなんですけど ソフトウェア開発の世界でよく耳にするドメイン駆動設計通称dddですね dddですねよく聞きます手元にあるのがdddの入門書から 抜粋したなんていうかその哲学的な迫進に迫る部分なんですはいはいはい 技術的なパターンリストよりはその考え方そのものを深く掘り下げていて 今日あなたと一緒に探っていきたいのはなぜdddはただのコーディング手法じゃないのか そしてそこから見えてくる本当に価値のあるソフトウェア開発って何だろうっていうその答えなんですよね いやぁdddって言葉だけがすごく一人歩きしてる感じありますよねありますね 多くの人がネオブジェクトとかリポジトリとかそういう技術的なパターンの集合体だと思いがちなんですよ もちろんそれも大事な一部なんですけどそれだけを追いかけてもdddの本当の力っていうのは得られない この資料が繰り返し訴えているのはdddが現実世界をどう捉えるかというモデリング手法 それをどう高度に落とし込むかという実践的パターンこの2つで1つのものだっていうことなんです なるほど両輪なんですねそうですで今回は特にその前者の考え方の部分 いわばdddの魂に迫っていきましょうと魂の部分ですか面白いですね では早速その魂に迫るためのキーワードから最初にこの軽量dddっていう言葉を見たとき正直に言うと これ効率的で良いアプローチなんじゃないかって思っちゃったんですよ ああ思いますよねパターンだけ学んですぐにコードをきれいにできるならそれに越したことはないだろうと でもこの資料はそれを罠だとはっきり言ってるんですよね一体どこにその落とし穴があるんでしょう いいポイントですねまさにその手軽さが罠なんですよ 資料にあるトンカチを持つとすべてが釘に見えるっていう理由がこの心理をすごく的確に表していて ああ有名な言葉ですね ええ新しいパターンを覚えると私たちって安心するんです この問題にはこのパターンを使えばいいっていう思考のショートカットが手に入るから でついついパターンを適用すること自体が目的になっちゃう ああわかりますすごくわかります覚えたての知識って使いたくなりますもんね そうなんですでもDDDが本当に解決したいのってコードをきれいにすることじゃなくて ビジネスの課題を正しく解決することなんですよ 技術的なパターンっていうのはそのビジネスの課題つまりドメインの本質を素直にコードで表現するための あくまでサポート役でしかない あくまでサポート役 パターンは何というか思考の余白を生み出すための道具なんです その生まれた余白をさらに高度な技術の探求に使うんじゃなくて このビジネスは本当は何を解決しようとしてるんだっていう ドメインの理解を深めるために使ってこそDDDの進化が発揮されると OKつまりパターンは目的じゃないと本質と向き合うための時間を稼ぐ手段なんだということですね じゃあそのドメインの本質と向き合うには具体的にどうすればいいんでしょう 僕らエンジニアはビジネスの専門家じゃないですし 資料が次に示しているのがドメインエクスパートとモデリングをするっていう考え方ですね ここで出てくる例え話がもう強烈で友人と旅行の約束をしたら当日ヘリで迎えに来たって まさかと思いますけどシステム開発の現場ではこれくらいの認識のズレが本当に起こり得ると 起こりますね本当にヘリは極端な例ですけど 私も若い頃在庫管理システムで引き当てっていう言葉の意味を勘違いしたまま開発を進めちゃったっていう苦い経験があって ほう僕の理解では在庫を予約するくらいの軽い意味だったんですけど 会計上の意味合いをまったる理解してなかったんです リリース直前に会計チームからこのロジックだと税務上資産形状ができませんって指摘されて もう大騒ぎですよ言葉たった一つのズレが数千万円の損失につながりかねなかったんですね 生々しいですねそれは資料のユーザーを登録するとユーザーを新規保存するなんていう言葉のズレはもうかわいく見えるくらいだ そうでしょでもその小さなズレの積み重ねがそういう大事故につながっていくわけですね 開発者が新規保存みたいなシステムに実直な言葉を使えば使うほど ビジネスの専門家はなんか難しい話してるなぁまあプロに任せようって対話から降りてしまう まさにそしてそのコミュニケーションの断絶こそが見当違いのソフトウェアを生み出す現況なんです ここで大事なのはドメインエクスパートっていうのは単なる発注者とかステークホルダーじゃなくて そのビジネスの実践者だっていうこと実践者 ええ彼らと同じ言葉を話して彼らの目から見えている景色を 我々開発者も理解しようと努める必要があるんですただ一方的に話を聞くだけでもダメなんですよね 資料の紙とペンしか触ったことがないものがデータベースのことを理解できるはずもないって一文には ハッとさせられました ええドメインエクスパートもテクノロジーで何が可能かなんて知らないわけですもんね その通りですだから対話は双方向のいわば真剣勝負じゃなきゃいけない 開発者はシステムで何が可能かを提示してドメインエクスパートはビジネスの知識を提供する お互いが先生であり生徒なんですなるほど そうやって知識を交換しあって ろ過するように上流して本当に価値のあるドメインモデルを一緒に作り上げていく 開発者はもうただの受け身な作業者じゃなくて 対話のパートナーとしてビジネス価値を最大化する責任があるんです その双方向の対話を実現するための具体的な武器がこの指き足す言語というわけですね はいいつでもどこでも存在するっていう意味の共通言語 これは面白いのはただビジネスで使われている言葉をそのまま使えばいいっていう話じゃないところですよね えむしろ対話を通じてお互いがこれだって納得できる より正確で誤解の余地のない言葉を発明していくそのプロセス自体が重要なんです 発明ですか プロジェクトだけの独自の言語をゼロから作り上げていくような作業ですね 資料のコード例がその重要性を物語ってますよね ユーザーの名前を変更するっていうごく自然な表現があるのに 僕ら開発者はついデータベースの更新っていう実装に引っ張られて アップデートネームって名付けがちだと やりがちですねこれをドメインの言葉に忠実に チェンジネームとすることがなぜそこまで決定的に重要なんですか 正直アップデートネームの方が技術者としてはしっくりきたりもするんですが そのしっくりくるっていうのが実は危険なサインかもしれないんですよ アップデートネームっていう技術的な言葉を使った瞬間 ドメインの言葉変更とコードの言葉更新の間に 目に見えない翻訳が生まれるんです翻訳 コードを読むたびに頭の中で アップデートは変更のことだなって変換しなくちゃいけない この小さな翻訳コストが何というか認知の税金みたいに 開発チーム全員に毎日少しずつ貸されていくんです認知の税金 面白い表現ですね それはまるで常にちょっとだけ意味の違う方言で話しているようなそういうストレスですね まさにそういうことです そう考えるとチェンジネームにするっていうのはもうただの好みじゃなくて プロジェクトの生産性に直結する重要な決断なんですね そしてその翻訳っていう雑音をなくして初めて 議論の背後にあるニュアンスとかより深い洞察に集中できるようになるんです 資料では言語は文化だって表現されてますけどまさにその通りで 共通言語を育てることはプロジェクト独自の文化を育てることと同じなんです そうやって会話を続けるうちにあれこの言葉なんだか曖昧じゃない この定義だとあのケースが表現できないぞみたいな気づきが生まれる それこそがモデルをより洗練させる絶好のチャンスになるんですよ その共通言語っていう考え方すごく納得感があるんですけど 一つ疑問が湧いてきましたはい何でしょう例えば巨大な ec サイトみたいに 物流チームと決済チームと商品カタログチームが関わるようなプロジェクトだと 全員が全く同じ言葉で話すのって逆に混乱しませんか ああ 物流チームの言う顧客とマーケティングチームの言う顧客って見てるものが全然違いそうですし素晴らしい まさに ddd が次に取り組むべき課題がそこなんです 一つの巨大な言語ですべてを支配しようとすると破綻します そこで登場するのが境界づけられたコンテクストという考え方です ドメインの国境のようなものという説明がすごくしっくりきましたまさに国境です 国境を超えれば言語とか通貨が変わるように コンテクストの境界を超えれば呼び聞かす言語も変わるんです なるほど同じユーザーっていう名前のクラスでも ログイン認証を担うコンテクストのユーザーはパスワード情報を持つでしょうし サークル機能を担うコンテクストのユーザーはサークルの所属情報を持つでしょう これらは全くの別物としてそれぞれのコンテクスト内で シンプルに定義する方がずっと素直で扱いやすいんですよ なるほど無理やり一つの巨大で万能なユーザーオブジェクトを作ろうとするから あらゆる部署の都合が絡み合った変更に弱い行動が生まれてしまうわけですね そうなんです境界線を引くことでそれぞれのチームは自分たちのモデルに集中できると そうですそれによってシステム全体が変化に強くなります ただもちろんそれぞれの国が完全に孤立してしまっては困りませんよね はいそこで重要になるのがそれらの関係性を図にした コンテクストマップですどの国とどの国がどういう関係にあるのか 例えば一方がもう一方の言語に合わせるのか前に翻訳役を置くのかとかですね それを明確にするドメイン全体の地図のようなものです地図ですか これがあることでチーム間の連携がスムーズになって全体像を見失わないで済むんです いやー面白いですねここまでを整理してみるとドメイン駆動設計っていうのは 単なるデザインパターンのカタログじゃないそれは ビジネスの専門家と開発者が対等なパートナーとして向き合って 指きたす言語っていう共通の文化を築いて そして境界づけられたコンテキストっていう国境線で巨大な複雑さを巧みに管理しながら ソフトウェアという道具とそれが解決すべき問題の本質を限りなく一致させ続けようとする 終わりなき旅のようなものだと言えそうですね ええその通りだと思いますまさに旅ですねそして資料の最後にあった ddd は ボトムアップであるっていう言葉がこの旅の本質を表している気がしました はいはい完成形ありきでトップダウンに進めるんじゃなくて まず目の前にあるドメインっていう複雑な問題を 対話を通じて一つ一つ紐解くことから始める まさにこの入門書が基礎から丁寧に解説してきたアプローチそのものですねそうですね では最後にこの短期を締めくるにあたってあなたに一つ思考の種を投げかけたいと思います 資料では指チタス言語の習得を 新しい外国語を覚えるようなものをと表現していましたよねはい 最初はギプスをはめられたような不自由さを感じるけれど 一度習得すれば驚くほど流暢に思考し会話できるようになると はいありました非常に印象的な比喩でした ここから一歩進めてこう考えてみてはどうでしょう もしそのようにして長い時間をかけて築き上げられた独自の言語と文化を持つプロジェクトに あなたが明日から参加することになったとしたらその国の言葉や文化をどうやって学び どうやってその国の一員として貢献しますか ただの旅行者で終わらないために何が必要だと思いますか