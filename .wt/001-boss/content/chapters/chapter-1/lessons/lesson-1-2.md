# ドメインエキスパートとの協業

## 概要

このレッスンでは、DDDにおけるドメインエキスパートとの協業について学びます。
なぜ協業が重要なのか、そして効果的なコミュニケーション手法について理解しましょう。

## ドメインエキスパートとは誰か

### ドメインエキスパートの定義

**ドメインエキスパート**とは、ビジネスドメインについて深い知識を持つ人のことです。
必ずしも「偉い人」や「肩書きのある人」ではありません。

ドメインエキスパートになりうる人：

| 役割 | 専門知識の例 |
|------|-----------|
| 営業担当者 | 顧客のニーズ、商談プロセス |
| カスタマーサポート | よくある問題、ユーザーの困りごと |
| 経理担当者 | 会計処理、請求ルール |
| 物流担当者 | 配送ルール、在庫管理 |
| 長年の現場担当者 | 暗黙のビジネスルール |

### 開発者だけでは不十分な理由

開発者がドキュメントを読んだだけでは、以下を把握できません：

- **暗黙のルール**: 「普通はこうする」という慣習
- **例外ケース**: 「でも、この場合は違う」というケース
- **優先度**: どのルールがより重要か
- **文脈**: なぜそのルールが存在するのか

```typescript
// 開発者だけで作ると...
function calculateShipping(weight: number): number {
  return weight * 100; // 単純に重量×100円
}

// ドメインエキスパートと話すと発覚する真実
// - 離島は追加料金がかかる
// - 3kg以上は別料金体系
// - 特定商品は重量計算が異なる
// - キャンペーン中は送料無料の閾値が変わる
```

## なぜ協業が重要か

### 知識の移転

ドメインエキスパートの**暗黙知**を、開発チームの**形式知**に変換することが目的です。

```
暗黙知（ドメインエキスパート）
    ↓ 協業・対話
形式知（ユビキタス言語・ドメインモデル）
    ↓ 実装
コード（ソフトウェア）
```

### 継続的な発見

一度の打ち合わせですべてを理解することは不可能です。
開発を進める中で新たな発見があり、モデルは**進化**していきます。

> 「最初のモデルは間違っている。重要なのは、それを認識し、改善し続けること。」
> — Eric Evans

## 効果的なコミュニケーション手法

### 1. イベントストーミング

**イベントストーミング**は、ビジネスプロセスを可視化するワークショップ手法です。

**進め方：**

1. オレンジ色の付箋に「起きること（イベント）」を書く
   - 例：「注文が確定された」「支払いが完了した」
2. 時系列に並べる
3. イベントを引き起こす「コマンド」と「アクター」を追加
4. 境界を見つけ、コンテキストを分離

**メリット：**
- 全員が同じ視点でビジネスを理解できる
- 隠れたビジネスルールが発見できる
- ユビキタス言語の素材が得られる

### 2. ホワイトボードセッション

シンプルだが効果的な手法です。

```
開発者: 「注文が作成されるとき、何が起きますか？」
エキスパート: 「まず在庫を確認して...」
開発者: （ホワイトボードに図を描きながら）
        「在庫確認というのは、どの時点で行われますか？」
エキスパート: 「カートに入れた時点ではなく、
              決済ボタンを押したタイミングです」
```

**ポイント：**
- 図を描きながら会話する
- 「それは具体的にどういうことですか？」と深掘りする
- 例を出してもらう

### 3. プロトタイピング

実際に動くものを見せて、認識を合わせます。

**効果的な使い方：**

```typescript
// まずシンプルなモデルを作成
class Order {
  items: OrderItem[];
  confirm(): void { /* ... */ }
}

// ドメインエキスパートにレビューしてもらう
// 「この confirm() が呼ばれたとき、
//   システムは何をすべきですか？」
```

フィードバックを得て、モデルを改善していきます。

## ユビキタス言語の構築

協業を通じて、チーム共通の言葉を作ります。

### 用語集の作成

| 用語 | 定義 | 注意点 |
|------|------|--------|
| 注文（Order） | 顧客が商品を購入する意思表示 | カートとは異なる |
| 確定（Confirm） | 注文を正式に受け付けること | 支払い完了とは別 |
| 引当（Reserve） | 在庫を特定の注文のために確保すること | - |

### コードへの反映

用語集の言葉は、そのままコードに使います。

```typescript
// 用語集の言葉がそのままメソッド名に
class Order {
  confirm(): void { /* ... */ }
}

class Inventory {
  reserve(quantity: number): void { /* ... */ }
}
```

## まとめ

- **ドメインエキスパート**は、ビジネスドメインの深い知識を持つ人
- 開発者だけでは**暗黙のルール**や**例外ケース**を把握できない
- **イベントストーミング**、**ホワイトボードセッション**、**プロトタイピング**が効果的
- 協業を通じて**ユビキタス言語**を構築し、コードに反映させる
