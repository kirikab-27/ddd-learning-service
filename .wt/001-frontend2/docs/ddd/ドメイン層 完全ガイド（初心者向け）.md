

**NotebookLM Transcriber - Phase 1 å®Ÿè£…è§£èª¬**

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒã‚±ãƒƒãƒˆ001ã§å®Ÿè£…ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ã¤ã„ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åˆå¿ƒè€…ã§ã‚‚ç†è§£ã§ãã‚‹ã‚ˆã†ã«è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“š ç›®æ¬¡

1. [ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ã¯ï¼Ÿ](#ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ã¯)
2. [ãªãœãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒå¿…è¦ãªã®ã‹ï¼Ÿ](#ãªãœãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒå¿…è¦ãªã®ã‹)
3. [å®Ÿè£…ã—ãŸ9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#å®Ÿè£…ã—ãŸ9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
4. [å®Ÿéš›ã®ä½¿ç”¨ä¾‹](#å®Ÿéš›ã®ä½¿ç”¨ä¾‹)
5. [ã‚ˆãã‚ã‚‹è³ªå•](#ã‚ˆãã‚ã‚‹è³ªå•)

---

## ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ã¯ï¼Ÿ

### ç°¡å˜ãªä¾‹ãˆè©±

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’**ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³**ã«ä¾‹ãˆã‚‹ã¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UIï¼ˆè¦‹ãŸç›®ï¼‰                        â”‚  â† ãŠå®¢ã•ã‚“ãŒè¦‹ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  APIï¼ˆæ³¨æ–‡å—ä»˜ï¼‰                     â”‚  â† ã‚¦ã‚§ã‚¤ã‚¿ãƒ¼ãŒæ³¨æ–‡ã‚’å—ã‘ã‚‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆæ–™ç†ã®ãƒ«ãƒ¼ãƒ«ï¼‰        â”‚  â† ãƒ¬ã‚·ãƒ”ã€èª¿ç†æ‰‹é †ã€é£Ÿæã®çŸ¥è­˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆä¿ç®¡ï¼‰                 â”‚  â† å†·è”µåº«ã€é£Ÿæç½®ãå ´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤** = **ã€Œãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ã€ã‚„ã€Œæ¥­å‹™ã®çŸ¥è­˜ã€ã‚’è¡¨ç¾ã™ã‚‹å ´æ‰€**

- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã¯100MBä»¥ä¸‹ã§ãªã„ã¨ã„ã‘ãªã„ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰
- å‡¦ç†ä¸­ã®çŠ¶æ…‹ã‹ã‚‰å®Œäº†çŠ¶æ…‹ã«é·ç§»ã§ãã‚‹ï¼ˆæ¥­å‹™ã®æµã‚Œï¼‰
- å¤±æ•—ã—ãŸã‚‰ãƒªãƒˆãƒ©ã‚¤ã§ãã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹ï¼ˆæ¥­å‹™ã®çŸ¥è­˜ï¼‰

ã“ã‚Œã‚‰ã®**ãƒ«ãƒ¼ãƒ«ã‚„çŸ¥è­˜**ã‚’ã€ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¾ã—ãŸã®ãŒãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§ã™ã€‚

---

## ãªãœãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### âŒ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒãªã„å ´åˆ

```typescript
// UIã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã«ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒæ•£ã‚‰ã°ã£ã¦ã„ã‚‹...
function uploadAudio(file: File) {
  // ã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
  if (file.size > 100 * 1024 * 1024) {
    alert("ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãã¾ã™ï¼");
    return;
  }

  // ã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
  if (!["audio/m4a", "audio/mp3"].includes(file.type)) {
    alert("å¯¾å¿œã—ã¦ã„ãªã„å½¢å¼ã§ã™ï¼");
    return;
  }

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜...
}

// åˆ¥ã®å ´æ‰€ã§ã‚‚åŒã˜ãƒã‚§ãƒƒã‚¯ãŒ...
function validateAudio(file: File) {
  if (file.size > 100 * 1024 * 1024) { // åŒã˜ãƒ«ãƒ¼ãƒ«ãŒé‡è¤‡ï¼
    return false;
  }
  // ...
}
```

**å•é¡Œç‚¹**:
- åŒã˜ãƒ«ãƒ¼ãƒ«ãŒè‰²ã€…ãªå ´æ‰€ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ï¼ˆé‡è¤‡ï¼‰
- ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›´ã™ã‚‹æ™‚ã€å…¨éƒ¨ã®å ´æ‰€ã‚’ä¿®æ­£ã—ãªã„ã¨ã„ã‘ãªã„
- ãƒã‚°ãŒæ··å…¥ã—ã‚„ã™ã„

### âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒã‚ã‚‹å ´åˆ

```typescript
// ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¯1ç®‡æ‰€ã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹
class AudioFileMeta {
  constructor(fileName: string, mimeType: string, sizeBytes: number) {
    // ã“ã“ã§ãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆ1ç®‡æ‰€ã ã‘ï¼ï¼‰
    if (sizeBytes > 100 * 1024 * 1024) {
      throw new InvalidAudioFileError("ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãã¾ã™");
    }
    // ...
  }
}

// UIã‹ã‚‰ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä½¿ãˆã‚‹
function uploadAudio(file: File) {
  try {
    const audioMeta = new AudioFileMeta(file.name, file.type, file.size);
    // ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ã¯è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼
  } catch (error) {
    alert(error.message);
  }
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ«ãƒ¼ãƒ«ãŒ1ç®‡æ‰€ã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹
- å¤‰æ›´ã™ã‚‹æ™‚ã‚‚1ç®‡æ‰€ã ã‘ä¿®æ­£ã™ã‚Œã°OK
- ãƒã‚°ãŒæ¸›ã‚‹
- ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„

---

## å®Ÿè£…ã—ãŸ9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

NotebookLM Transcriber ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯ã€9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```
ğŸ“¦ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”œâ”€â”€ ğŸ·ï¸ SessionIdï¼ˆè­˜åˆ¥å­ï¼‰
â”œâ”€â”€ ğŸ’ AudioFileMetaï¼ˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ï¼‰
â”œâ”€â”€ ğŸ’ TranscriptionEngineï¼ˆã‚¨ãƒ³ã‚¸ãƒ³é¸æŠï¼‰
â”œâ”€â”€ ğŸ’ TranscriptionStatusï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰
â”œâ”€â”€ ğŸ’ TranscriptionTextï¼ˆçµæœãƒ†ã‚­ã‚¹ãƒˆï¼‰
â”œâ”€â”€ ğŸ’ TranscriptionFailureï¼ˆå¤±æ•—æƒ…å ±ï¼‰
â”œâ”€â”€ ğŸ¯ TranscriptionSessionï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆï¼‰
â”œâ”€â”€ âš ï¸ TranscriptionErrorsï¼ˆä¾‹å¤–ï¼‰
â””â”€â”€ ğŸ”Œ SpeechToTextServiceï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
```

### å‡¡ä¾‹
- ğŸ·ï¸ = è­˜åˆ¥å­ï¼ˆIDï¼‰
- ğŸ’ = å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆValue Objectï¼‰
- ğŸ¯ = é›†ç´„ãƒ«ãƒ¼ãƒˆï¼ˆAggregate Rootï¼‰
- âš ï¸ = ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–
- ğŸ”Œ = ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

---

## 1. SessionIdï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**æ–‡å­—èµ·ã“ã—å‡¦ç†1å›1å›ã‚’è­˜åˆ¥ã™ã‚‹ID**

ä¾‹ãˆã°ã€è¤‡æ•°ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒæ™‚ã«æ–‡å­—èµ·ã“ã—ã—ã¦ã„ã‚‹æ™‚ã€ã©ã‚ŒãŒã©ã‚Œã‹åŒºåˆ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰

```typescript
// ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®å‹ã‚’å®šç¾©
export type SessionId = string;

// ãƒ©ãƒ³ãƒ€ãƒ ãªIDã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
export function generateSessionId(): SessionId {
  return crypto.randomUUID(); // ä¾‹: "a3f2c1b0-1234-5678-90ab-cdef12345678"
}
```

### ä½¿ã„æ–¹

```typescript
const sessionId = generateSessionId();
console.log(sessionId); // "a3f2c1b0-1234-5678-90ab-cdef12345678"
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

- å®…é…ä¾¿ã®ã€Œè¿½è·¡ç•ªå·ã€
- ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®ã€Œæ³¨æ–‡ç•ªå·ã€
- ç—…é™¢ã®ã€Œè¨ºå¯Ÿåˆ¸ç•ªå·ã€

ãã‚Œãã‚Œã®å‡¦ç†ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã®ç•ªå·ã§ã™ã€‚

---

## 2. AudioFileMetaï¼ˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’ä¿æŒã—ã€ãƒ«ãƒ¼ãƒ«é•åã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹**

### ä¿æŒã™ã‚‹æƒ…å ±

```typescript
class AudioFileMeta {
  constructor(
    public readonly fileName: string,      // ãƒ•ã‚¡ã‚¤ãƒ«å: "meeting.m4a"
    public readonly mimeType: string,      // å½¢å¼: "audio/m4a"
    public readonly sizeBytes: number,     // ã‚µã‚¤ã‚º: 10485760 (10MB)
    public readonly durationSeconds: number | null  // é•·ã•: 600 (10åˆ†)
  ) {
    this.validate(); // ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼
  }
}
```

### ãƒ«ãƒ¼ãƒ«ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

| é …ç›® | ãƒ«ãƒ¼ãƒ« | ãƒ€ãƒ¡ãªä¾‹ |
|------|--------|---------|
| ãƒ•ã‚¡ã‚¤ãƒ«å | 1ã€œ255æ–‡å­— | ç©ºæ–‡å­— `""` |
| å½¢å¼ | m4a, mp3, wav ã®ã¿ | mp4å‹•ç”» `"audio/mp4"` |
| ã‚µã‚¤ã‚º | 1ãƒã‚¤ãƒˆã€œ100MB | 200MB `209715200` |
| é•·ã• | 1ã€œ1800ç§’ï¼ˆ30åˆ†ï¼‰ | 1æ™‚é–“ `3600` |

### ä½¿ã„æ–¹

```typescript
// âœ… æ­£ã—ã„ä½¿ã„æ–¹ï¼ˆãƒ«ãƒ¼ãƒ«ã‚’æº€ãŸã—ã¦ã„ã‚‹ï¼‰
const goodMeta = new AudioFileMeta(
  "meeting.m4a",    // ãƒ•ã‚¡ã‚¤ãƒ«åOK
  "audio/m4a",      // å½¢å¼OK
  10 * 1024 * 1024, // 10MB OK
  600               // 10åˆ† OK
);

// âŒ ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ä¾‹ï¼ˆãƒ«ãƒ¼ãƒ«é•åï¼‰
try {
  const badMeta = new AudioFileMeta(
    "huge-file.m4a",
    "audio/m4a",
    200 * 1024 * 1024, // 200MB - ã‚µã‚¤ã‚ºã‚ªãƒ¼ãƒãƒ¼ï¼
    600
  );
} catch (error) {
  console.error(error.message);
  // "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯1ãƒã‚¤ãƒˆã€œ100MBã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„"
}
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

éƒµä¾¿å±€ã§è·ç‰©ã‚’é€ã‚‹æ™‚ã®ãƒã‚§ãƒƒã‚¯ï¼š
- é‡ã•åˆ¶é™: 30kgã¾ã§ï¼ˆã“ã‚Œã‚’è¶…ãˆã‚‹ã¨æ–­ã‚‰ã‚Œã‚‹ï¼‰
- ã‚µã‚¤ã‚ºåˆ¶é™: 3è¾ºã®åˆè¨ˆãŒ170cmã¾ã§
- é€ã‚ŠçŠ¶ã®è¨˜å…¥: ä½æ‰€ãŒç©ºæ¬„ã ã¨ãƒ€ãƒ¡

ã“ã‚Œã¨åŒã˜ã‚ˆã†ã«ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

---

## 3. TranscriptionEngineï¼ˆæ–‡å­—èµ·ã“ã—ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**ã©ã®AIã‚¨ãƒ³ã‚¸ãƒ³ã§æ–‡å­—èµ·ã“ã—ã™ã‚‹ã‹ã‚’æŒ‡å®šã™ã‚‹**

ç¾åœ¨ã¯Whisperã®ã¿å¯¾å¿œã€å°†æ¥çš„ã«Googleã‚„Azureã‚‚å¯¾å¿œäºˆå®šã€‚

### ã‚³ãƒ¼ãƒ‰

```typescript
class TranscriptionEngine {
  private constructor(public readonly value: "whisper" | "google" | ...) {}

  // æ–‡å­—åˆ—ã‹ã‚‰ç”Ÿæˆï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
  static fromString(engine: string): TranscriptionEngine {
    if (engine !== "whisper") {
      throw new InvalidTranscriptionEngineError(
        `ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™: ${engine}`
      );
    }
    return new TranscriptionEngine("whisper");
  }

  // Whisperã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç”Ÿæˆï¼ˆä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
  static whisper(): TranscriptionEngine {
    return new TranscriptionEngine("whisper");
  }
}
```

### ä½¿ã„æ–¹

```typescript
// âœ… æ­£ã—ã„ä½¿ã„æ–¹
const engine = TranscriptionEngine.fromString("whisper");
console.log(engine.toString()); // "whisper"

// ã¾ãŸã¯
const engine2 = TranscriptionEngine.whisper();

// âŒ ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ä¾‹
try {
  const badEngine = TranscriptionEngine.fromString("unknown");
} catch (error) {
  console.error(error.message);
  // "ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™: unknown"
}
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã®é¸æŠï¼š
- Googleç¿»è¨³
- DeepL
- Microsoft Translator

ã©ã®ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã†ã‹ã‚’é¸ã¶ã®ã¨åŒã˜ã§ã™ã€‚

---

## 4. TranscriptionStatusï¼ˆå‡¦ç†çŠ¶æ…‹ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**æ–‡å­—èµ·ã“ã—å‡¦ç†ãŒä»Šã©ã®æ®µéšã«ã‚ã‚‹ã‹ã‚’ç®¡ç†ã™ã‚‹**

### 4ã¤ã®çŠ¶æ…‹

```
Requested â†’ Processing â†’ Completed
   â†“                         â†‘
   â””â”€â”€â”€â”€â”€â”€â”€â†’ Failed â†â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| çŠ¶æ…‹ | æ„å‘³ | æ¬¡ã«é€²ã‚ã‚‹çŠ¶æ…‹ |
|------|------|---------------|
| **Requested** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜æ¸ˆã¿ | Processing, Failed |
| **Processing** | å‡¦ç†ä¸­ | Completed, Failed |
| **Completed** | å®Œäº†ï¼ˆçµ‚ç«¯ï¼‰ | ãªã— |
| **Failed** | å¤±æ•—ï¼ˆçµ‚ç«¯ï¼‰ | ãªã— |

### çŠ¶æ…‹é·ç§»ãƒ«ãƒ¼ãƒ«

```typescript
class TranscriptionStatus {
  canTransitionTo(to: TranscriptionStatus): boolean {
    // Requested ã‹ã‚‰ Processing ã¸ã¯ OK
    // Completed ã‹ã‚‰ Processing ã¸ã¯ NGï¼ˆçµ‚ç«¯çŠ¶æ…‹ï¼‰
  }
}
```

### ä½¿ã„æ–¹

```typescript
const status = TranscriptionStatus.requested();

// âœ… è¨±å¯ã•ã‚Œã‚‹é·ç§»
if (status.canTransitionTo(TranscriptionStatus.processing())) {
  console.log("å‡¦ç†ã‚’é–‹å§‹ã§ãã¾ã™");
}

// âŒ è¨±å¯ã•ã‚Œãªã„é·ç§»
const completed = TranscriptionStatus.completed();
if (!completed.canTransitionTo(TranscriptionStatus.processing())) {
  console.log("å®Œäº†æ¸ˆã¿ãªã®ã§å‡¦ç†ã‚’å†é–‹ã§ãã¾ã›ã‚“");
}
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

å®…é…ä¾¿ã®é…é€çŠ¶æ…‹ï¼š
1. **å—ä»˜å®Œäº†**ï¼ˆRequestedï¼‰
2. **é…é€ä¸­**ï¼ˆProcessingï¼‰
3. **é…é”å®Œäº†**ï¼ˆCompletedï¼‰ã¾ãŸã¯ **é…é”ä¸å¯**ï¼ˆFailedï¼‰

é…é”å®Œäº†ã—ãŸè·ç‰©ã‚’ã€Œé…é€ä¸­ã€ã«æˆ»ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼ˆçµ‚ç«¯çŠ¶æ…‹ï¼‰ã€‚

---

## 5. TranscriptionTextï¼ˆæ–‡å­—èµ·ã“ã—çµæœï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**æ–‡å­—èµ·ã“ã—ã®çµæœãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹**

### ã‚³ãƒ¼ãƒ‰

```typescript
class TranscriptionText {
  constructor(public readonly value: string) {}

  toString(): string {
    return this.value;
  }
}
```

### ä½¿ã„æ–¹

```typescript
const result = new TranscriptionText("ã“ã‚“ã«ã¡ã¯ã€ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã§ã™ã­ã€‚");
console.log(result.toString()); // "ã“ã‚“ã«ã¡ã¯ã€ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã§ã™ã­ã€‚"
```

### ãªãœã‚¯ãƒ©ã‚¹ã«ã™ã‚‹ã®ã‹ï¼Ÿ

å˜ç´”ãªæ–‡å­—åˆ—ã§ã‚‚è‰¯ã„ã§ã™ãŒã€ã‚¯ãƒ©ã‚¹ã«ã™ã‚‹ã“ã¨ã§ï¼š
- å°†æ¥çš„ã«ã€Œç”Ÿãƒ†ã‚­ã‚¹ãƒˆã€ã€Œæ•´å½¢æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã€ã€Œè¦ç´„ã€ãªã©ã‚’è¿½åŠ ã§ãã‚‹
- å‹å®‰å…¨æ€§ãŒå‘ä¸Šï¼ˆé–“é•ã£ã¦åˆ¥ã®æ–‡å­—åˆ—ã‚’æ¸¡ã™ã“ã¨ã‚’é˜²ãï¼‰

---

## 6. TranscriptionFailureï¼ˆå¤±æ•—æƒ…å ±ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**æ–‡å­—èµ·ã“ã—ãŒå¤±æ•—ã—ãŸæ™‚ã®è©³ç´°æƒ…å ±ã‚’ä¿æŒã™ã‚‹**

### ä¿æŒã™ã‚‹æƒ…å ±

```typescript
class TranscriptionFailure {
  constructor(
    public readonly reason: string,        // ç†ç”±: "APIãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"
    public readonly errorCode: string | null,  // ã‚³ãƒ¼ãƒ‰: "API_TIMEOUT"
    public readonly retryable: boolean     // ãƒªãƒˆãƒ©ã‚¤å¯èƒ½?: true
  ) {}
}
```

### 4ã¤ã®ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰

```typescript
// 1. APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒªãƒˆãƒ©ã‚¤å¯èƒ½ï¼‰
const timeout = TranscriptionFailure.apiTimeout();
// reason: "APIãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"
// errorCode: "API_TIMEOUT"
// retryable: true

// 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆãƒªãƒˆãƒ©ã‚¤å¯èƒ½ï¼‰
const rateLimited = TranscriptionFailure.rateLimited();
// reason: "APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"
// errorCode: "RATE_LIMITED"
// retryable: true

// 3. èªè¨¼å¤±æ•—ï¼ˆãƒªãƒˆãƒ©ã‚¤ä¸å¯ï¼‰
const authFailed = TranscriptionFailure.authFailed();
// reason: "APIã‚­ãƒ¼ã®èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
// errorCode: "AUTH_FAILED"
// retryable: false

// 4. ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼ï¼ˆãƒªãƒˆãƒ©ã‚¤ä¸å¯ï¼‰
const general = TranscriptionFailure.general("ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
// reason: "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
// errorCode: null
// retryable: false
```

### ä½¿ã„æ–¹

```typescript
try {
  // æ–‡å­—èµ·ã“ã—å‡¦ç†...
} catch (error) {
  const failure = TranscriptionFailure.apiTimeout();

  if (failure.retryable) {
    console.log("ãƒªãƒˆãƒ©ã‚¤ã§ãã¾ã™:", failure.reason);
  } else {
    console.log("ãƒªãƒˆãƒ©ã‚¤ã§ãã¾ã›ã‚“:", failure.reason);
  }
}
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

ATMã§ãŠé‡‘ã‚’å¼•ãå‡ºãã†ã¨ã—ãŸæ™‚ã®ã‚¨ãƒ©ãƒ¼ï¼š
- **æ®‹é«˜ä¸è¶³**ï¼ˆãƒªãƒˆãƒ©ã‚¤ä¸å¯ï¼‰â†’ ãŠé‡‘ã‚’å…¥é‡‘ã—ãªã„ã¨è§£æ±ºã—ãªã„
- **ä¸€æ™‚çš„ãªé€šä¿¡ã‚¨ãƒ©ãƒ¼**ï¼ˆãƒªãƒˆãƒ©ã‚¤å¯èƒ½ï¼‰â†’ ã‚‚ã†ä¸€åº¦è©¦ã›ã°æˆåŠŸã™ã‚‹ã‹ã‚‚
- **ã‚«ãƒ¼ãƒ‰èª­ã¿å–ã‚Šã‚¨ãƒ©ãƒ¼**ï¼ˆãƒªãƒˆãƒ©ã‚¤å¯èƒ½ï¼‰â†’ ã‚«ãƒ¼ãƒ‰ã‚’å…¥ã‚Œç›´ã›ã°OK

---

## 7. TranscriptionSessionï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**1å›ã®æ–‡å­—èµ·ã“ã—å‡¦ç†å…¨ä½“ã‚’ç®¡ç†ã™ã‚‹ä¸­å¿ƒçš„ãªã‚¯ãƒ©ã‚¹**

ã“ã‚ŒãŒ**ä¸€ç•ªé‡è¦**ãªã‚¯ãƒ©ã‚¹ã§ã™ã€‚ä»–ã®å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ã„ã¾ã™ã€‚

### ä¿æŒã™ã‚‹æƒ…å ±

```typescript
class TranscriptionSession {
  private constructor(
    public readonly sessionId: SessionId,           // ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
    public readonly audioFileMeta: AudioFileMeta,   // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±
    public readonly engine: TranscriptionEngine,    // ä½¿ç”¨ã‚¨ãƒ³ã‚¸ãƒ³
    private _status: TranscriptionStatus,           // ç¾åœ¨ã®çŠ¶æ…‹
    private _result: TranscriptionText | null,      // çµæœï¼ˆå®Œäº†æ™‚ã®ã¿ï¼‰
    private _failure: TranscriptionFailure | null,  // å¤±æ•—æƒ…å ±ï¼ˆå¤±æ•—æ™‚ã®ã¿ï¼‰
    public readonly createdAt: Date,                // ä½œæˆæ—¥æ™‚
    private _completedAt: Date | null,              // å®Œäº†æ—¥æ™‚
    private _failedAt: Date | null                  // å¤±æ•—æ—¥æ™‚
  ) {}
}
```

### 3ã¤ã®é‡è¦ãƒ¡ã‚½ãƒƒãƒ‰

```typescript
// 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
static create(
  audioFileMeta: AudioFileMeta,
  engine: TranscriptionEngine,
  now: Date
): TranscriptionSession

// 2. å‡¦ç†ã‚’é–‹å§‹ï¼ˆRequested â†’ Processingï¼‰
startProcessing(now: Date): void

// 3. å‡¦ç†ã‚’å®Œäº†ï¼ˆProcessing â†’ Completedï¼‰
complete(result: TranscriptionText, now: Date): void

// 4. å‡¦ç†ã‚’å¤±æ•—ï¼ˆRequested/Processing â†’ Failedï¼‰
fail(failure: TranscriptionFailure, now: Date): void
```

### ä½¿ã„æ–¹ã®æµã‚Œ

```typescript
// ã‚¹ãƒ†ãƒƒãƒ—1: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
const audioMeta = new AudioFileMeta("meeting.m4a", "audio/m4a", 10000000, 600);
const engine = TranscriptionEngine.whisper();
const session = TranscriptionSession.create(audioMeta, engine, new Date());
console.log(session.status.toString()); // "Requested"

// ã‚¹ãƒ†ãƒƒãƒ—2: å‡¦ç†é–‹å§‹
session.startProcessing(new Date());
console.log(session.status.toString()); // "Processing"

// ã‚¹ãƒ†ãƒƒãƒ—3a: æˆåŠŸã—ãŸå ´åˆ
const result = new TranscriptionText("æ–‡å­—èµ·ã“ã—çµæœã®ãƒ†ã‚­ã‚¹ãƒˆ");
session.complete(result, new Date());
console.log(session.status.toString()); // "Completed"
console.log(session.result?.toString()); // "æ–‡å­—èµ·ã“ã—çµæœã®ãƒ†ã‚­ã‚¹ãƒˆ"

// ã¾ãŸã¯ ã‚¹ãƒ†ãƒƒãƒ—3b: å¤±æ•—ã—ãŸå ´åˆ
const failure = TranscriptionFailure.apiTimeout();
session.fail(failure, new Date());
console.log(session.status.toString()); // "Failed"
console.log(session.failure?.reason); // "APIãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ..."
```

### ä¸æ­£ãªæ“ä½œã¯é˜²ãŒã‚Œã‚‹

```typescript
// âŒ å®Œäº†å¾Œã«å†åº¦å‡¦ç†é–‹å§‹ã—ã‚ˆã†ã¨ã™ã‚‹ â†’ ã‚¨ãƒ©ãƒ¼ï¼
const session = TranscriptionSession.create(audioMeta, engine, new Date());
session.startProcessing(new Date());
session.complete(result, new Date());

try {
  session.startProcessing(new Date()); // ãƒ€ãƒ¡ï¼
} catch (error) {
  console.error(error.message);
  // "Requested â†’ Processing ä»¥å¤–ã®é·ç§»ã¯ä¸å¯: ç¾åœ¨ã®çŠ¶æ…‹=Completed"
}
```

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã®æ³¨æ–‡ï¼š

```
1. æ³¨æ–‡ä½œæˆï¼ˆcreateï¼‰
   â”œâ”€ æ³¨æ–‡ç•ªå·: #12345
   â”œâ”€ å•†å“æƒ…å ±: MacBook Pro
   â”œâ”€ é…é€æ–¹æ³•: å®…é…ä¾¿
   â””â”€ çŠ¶æ…‹: æ³¨æ–‡å—ä»˜

2. å‡¦ç†é–‹å§‹ï¼ˆstartProcessingï¼‰
   â””â”€ çŠ¶æ…‹: å‡¦ç†ä¸­

3. å®Œäº† or å¤±æ•—
   æˆåŠŸ â†’ çŠ¶æ…‹: é…é€å®Œäº†
   å¤±æ•— â†’ çŠ¶æ…‹: ã‚­ãƒ£ãƒ³ã‚»ãƒ«
```

TranscriptionSessionã¯ã€ã“ã®æ³¨æ–‡ç®¡ç†ã¨åŒã˜ã‚ˆã†ã«ã€1å›ã®æ–‡å­—èµ·ã“ã—å‡¦ç†ã‚’æœ€åˆã‹ã‚‰æœ€å¾Œã¾ã§ç®¡ç†ã—ã¾ã™ã€‚

---

## 8. TranscriptionErrorsï¼ˆã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã‚’æ˜ç¢ºã«åŒºåˆ¥ã™ã‚‹**

### 4ã¤ã®ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹

```typescript
// 1. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
class InvalidAudioFileError extends Error {
  // ä½¿ç”¨ä¾‹: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹
}

// 2. ã‚µãƒãƒ¼ãƒˆå¤–ã®ã‚¨ãƒ³ã‚¸ãƒ³æŒ‡å®šã‚¨ãƒ©ãƒ¼
class InvalidTranscriptionEngineError extends Error {
  // ä½¿ç”¨ä¾‹: "unknown" ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æŒ‡å®šã—ãŸ
}

// 3. æ–‡å­—èµ·ã“ã—å‡¦ç†ã®å¤±æ•—ã‚¨ãƒ©ãƒ¼
class TranscriptionFailedError extends Error {
  constructor(message: string, public readonly failure: TranscriptionFailure)
  // ä½¿ç”¨ä¾‹: APIå‘¼ã³å‡ºã—ãŒå¤±æ•—ã—ãŸ
}

// 4. ä¸æ­£ãªçŠ¶æ…‹é·ç§»ã‚¨ãƒ©ãƒ¼
class InvalidStateTransitionError extends Error {
  // ä½¿ç”¨ä¾‹: Completed â†’ Processing ã¸ã®é·ç§»ã‚’è©¦ã¿ãŸ
}
```

### ä½¿ã„æ–¹

```typescript
try {
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹
  const meta = new AudioFileMeta("huge.m4a", "audio/m4a", 200000000, 600);
} catch (error) {
  if (error instanceof InvalidAudioFileError) {
    console.error("ãƒ•ã‚¡ã‚¤ãƒ«ã®å•é¡Œ:", error.message);
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦ãã ã•ã„ã€ã¨è¡¨ç¤º
  }
}

try {
  // ã‚µãƒãƒ¼ãƒˆå¤–ã®ã‚¨ãƒ³ã‚¸ãƒ³
  const engine = TranscriptionEngine.fromString("unknown");
} catch (error) {
  if (error instanceof InvalidTranscriptionEngineError) {
    console.error("ã‚¨ãƒ³ã‚¸ãƒ³ã®å•é¡Œ:", error.message);
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå¯¾å¿œã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€ã¨è¡¨ç¤º
  }
}
```

### ãªãœåˆ†ã‘ã‚‹ï¼Ÿ

é€šå¸¸ã® `Error` ã ã‘ã ã¨ã€ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ãŒã‚ã‹ã‚Šã¾ã›ã‚“ï¼š

```typescript
// âŒ ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ãŒã‚ã‹ã‚‰ãªã„
try {
  // ä½•ã‹å‡¦ç†
} catch (error) {
  console.error(error.message); // ã“ã‚Œã ã‘ã§ã¯å¯¾å‡¦æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã„
}

// âœ… ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã§å‡¦ç†ã‚’åˆ†ã‘ã‚‰ã‚Œã‚‹
try {
  // ä½•ã‹å‡¦ç†
} catch (error) {
  if (error instanceof InvalidAudioFileError) {
    // ãƒ•ã‚¡ã‚¤ãƒ«ã®å•é¡Œ â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¦å†é€ä¿¡
  } else if (error instanceof TranscriptionFailedError) {
    // APIå¤±æ•— â†’ ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
  }
}
```

---

## 9. SpeechToTextServiceï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰

### ä½•ã®ãŸã‚ï¼Ÿ

**éŸ³å£°â†’ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ã‚’æŠ½è±¡åŒ–ã™ã‚‹**

å®Ÿéš›ã®Whisper APIã‚„Google APIã¨ã®é€šä¿¡ã¯ã€Infrastructureå±¤ã§å®Ÿè£…ã—ã¾ã™ã€‚
ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§ã¯ã€Œã“ã†ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã¯ãšã€ã¨ã„ã†ç´„æŸã ã‘ã‚’å®šç¾©ã—ã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰

```typescript
interface SpeechToTextService {
  /**
   * éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›
   * @param audio éŸ³å£°ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¤ãƒŠãƒªï¼‰
   * @param language è¨€èªã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: "ja"ï¼‰
   * @returns æ–‡å­—èµ·ã“ã—çµæœã®ãƒ†ã‚­ã‚¹ãƒˆ
   */
  transcribe(audio: Uint8Array, language: "ja"): Promise<string>;
}
```

### å®Ÿè£…ä¾‹ï¼ˆInfrastructureå±¤ã§å®Ÿè£…ï¼‰

```typescript
// Whisper API ã‚’ä½¿ã†å®Ÿè£…
class WhisperSpeechToTextService implements SpeechToTextService {
  async transcribe(audio: Uint8Array, language: "ja"): Promise<string> {
    // Whisper API ã‚’å‘¼ã³å‡ºã™
    const response = await fetch("https://api.openai.com/v1/audio/transcriptions", {
      method: "POST",
      body: audio,
      // ...
    });
    return response.json().text;
  }
}

// Google API ã‚’ä½¿ã†å®Ÿè£…
class GoogleSpeechToTextService implements SpeechToTextService {
  async transcribe(audio: Uint8Array, language: "ja"): Promise<string> {
    // Google API ã‚’å‘¼ã³å‡ºã™
    // ...
  }
}

// ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
class MockSpeechToTextService implements SpeechToTextService {
  async transcribe(audio: Uint8Array, language: "ja"): Promise<string> {
    return "ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ";
  }
}
```

### ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã™ã‚‹ã®ã‹ï¼Ÿ

1. **ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„**: ãƒ¢ãƒƒã‚¯å®Ÿè£…ã‚’ä½¿ãˆã‚‹
2. **åˆ‡ã‚Šæ›¿ãˆã‚„ã™ã„**: Whisperã‹ã‚‰Googleã«å¤‰æ›´ã—ã¦ã‚‚ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯å¤‰æ›´ä¸è¦
3. **ä¾å­˜é–¢ä¿‚ã®é€†è»¢**: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒInfrastructureå±¤ã«ä¾å­˜ã—ãªã„

### å®Ÿä¸–ç•Œã®ä¾‹ãˆ

ã‚³ãƒ³ã‚»ãƒ³ãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ï¼š
- ã©ã‚“ãªé›»åŒ–è£½å“ï¼ˆå®Ÿè£…ï¼‰ã§ã‚‚ã€ã‚³ãƒ³ã‚»ãƒ³ãƒˆã®å½¢ã•ãˆåˆãˆã°ä½¿ãˆã‚‹
- æƒé™¤æ©Ÿã§ã‚‚ã€ãƒ†ãƒ¬ãƒ“ã§ã‚‚ã€åŒã˜ã‚³ãƒ³ã‚»ãƒ³ãƒˆã«æŒ¿ã›ã‚‹
- ã‚³ãƒ³ã‚»ãƒ³ãƒˆã®è¦æ ¼ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ãŒæ±ºã¾ã£ã¦ã„ã‚Œã°ã€ä¸­èº«ï¼ˆå®Ÿè£…ï¼‰ã¯ä½•ã§ã‚‚OK

---

## å®Ÿéš›ã®ä½¿ç”¨ä¾‹

### ã‚·ãƒŠãƒªã‚ª: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–‡å­—èµ·ã“ã—ã™ã‚‹

```typescript
// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—1: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’ä½œæˆ
// ========================================
const audioMeta = new AudioFileMeta(
  "meeting-2025-01-19.m4a",  // ãƒ•ã‚¡ã‚¤ãƒ«å
  "audio/m4a",                // å½¢å¼
  15 * 1024 * 1024,           // 15MB
  900                          // 15åˆ†
);

// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—2: ä½¿ç”¨ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã‚’é¸æŠ
// ========================================
const engine = TranscriptionEngine.whisper();

// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—3: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
// ========================================
const session = TranscriptionSession.create(
  audioMeta,
  engine,
  new Date()
);

console.log("ã‚»ãƒƒã‚·ãƒ§ãƒ³ID:", session.sessionId);
// "a3f2c1b0-1234-5678-90ab-cdef12345678"

console.log("çŠ¶æ…‹:", session.status.toString());
// "Requested"

// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—4: å‡¦ç†ã‚’é–‹å§‹
// ========================================
session.startProcessing(new Date());
console.log("çŠ¶æ…‹:", session.status.toString());
// "Processing"

// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—5a: æˆåŠŸã—ãŸå ´åˆ
// ========================================
try {
  // å®Ÿéš›ã®æ–‡å­—èµ·ã“ã—å‡¦ç†ï¼ˆInfrastructureå±¤ï¼‰
  const speechService = new WhisperSpeechToTextService();
  const audioData = new Uint8Array([...]); // éŸ³å£°ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿
  const text = await speechService.transcribe(audioData, "ja");

  // çµæœã‚’ä¿å­˜
  const result = new TranscriptionText(text);
  session.complete(result, new Date());

  console.log("çŠ¶æ…‹:", session.status.toString()); // "Completed"
  console.log("çµæœ:", session.result?.toString());
  // "æœ¬æ—¥ã®ä¼šè­°ã§ã¯ã€æ¥æœŸã®äºˆç®—ã«ã¤ã„ã¦è­°è«–ã—ã¾ã—ãŸ..."

} catch (error) {
  // ========================================
  // ã‚¹ãƒ†ãƒƒãƒ—5b: å¤±æ•—ã—ãŸå ´åˆ
  // ========================================
  let failure: TranscriptionFailure;

  if (error.message.includes("timeout")) {
    failure = TranscriptionFailure.apiTimeout();
  } else if (error.message.includes("rate limit")) {
    failure = TranscriptionFailure.rateLimited();
  } else {
    failure = TranscriptionFailure.general(error.message);
  }

  session.fail(failure, new Date());

  console.log("çŠ¶æ…‹:", session.status.toString()); // "Failed"
  console.log("å¤±æ•—ç†ç”±:", session.failure?.reason);
  console.log("ãƒªãƒˆãƒ©ã‚¤å¯èƒ½?:", session.failure?.retryable);
}

// ========================================
// ã‚¹ãƒ†ãƒƒãƒ—6: çµæœã‚’ä¿å­˜ï¼ˆApplicationå±¤ï¼‰
// ========================================
// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
await repository.save(session);
```

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q1: ãªãœã“ã‚“ãªã«è¤‡é›‘ã«ã™ã‚‹ã®ï¼Ÿã‚·ãƒ³ãƒ—ãƒ«ã˜ã‚ƒãƒ€ãƒ¡ï¼Ÿ

**A**: å°ã•ã„ã‚¢ãƒ—ãƒªãªã‚‰ã‚·ãƒ³ãƒ—ãƒ«ã§OKã§ã™ã€‚ã§ã‚‚ã€ä»¥ä¸‹ã®å ´åˆã¯æœ‰åŠ¹ã§ã™ï¼š

- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒè¤‡é›‘ï¼ˆãŸãã•ã‚“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- è¤‡æ•°ã®å ´æ‰€ã§åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ã†ï¼ˆé‡è¤‡ã‚’é¿ã‘ã‚‹ï¼‰
- é•·æœŸé–“ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã™ã‚‹ï¼ˆãƒã‚°ã‚’æ¸›ã‚‰ã™ï¼‰
- ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹ï¼ˆå½¹å‰²åˆ†æ‹…ãŒã—ã‚„ã™ã„ï¼‰

### Q2: å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã£ã¦ä½•ï¼Ÿæ™®é€šã®ã‚¯ãƒ©ã‚¹ã¨ä½•ãŒé•ã†ï¼Ÿ

**A**: å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹å¾´ï¼š

```typescript
// æ™®é€šã®ã‚¯ãƒ©ã‚¹ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰
class User {
  id: number;      // IDã§è­˜åˆ¥ã™ã‚‹
  name: string;    // åå‰ã¯å¤‰æ›´å¯èƒ½

  changeName(newName: string) {
    this.name = newName; // çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹
  }
}

// å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
class AudioFileMeta {
  readonly fileName: string;  // å…¨ã¦ readonly
  readonly mimeType: string;  // å¤‰æ›´ä¸å¯

  // å¤‰æ›´ãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ï¼
  // æ–°ã—ã„å€¤ãŒæ¬²ã—ã‘ã‚Œã°ã€æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹
}
```

**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ = ä¸å¤‰ï¼ˆå¤‰æ›´ã§ããªã„ï¼‰ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**

### Q3: ãªãœ `private constructor` ã‚’ä½¿ã†ã®ï¼Ÿ

**A**: ç›´æ¥ `new` ã•ã›ãªã„ã“ã¨ã§ã€ä½œæˆãƒ«ãƒ¼ãƒ«ã‚’çµ±ä¸€ã§ãã¾ã™ï¼š

```typescript
class TranscriptionSession {
  private constructor(...) {} // å¤–ã‹ã‚‰ new ã§ããªã„

  // å¿…ãšã“ã®ãƒ¡ã‚½ãƒƒãƒ‰çµŒç”±ã§ä½œæˆ
  static create(...): TranscriptionSession {
    // ã“ã“ã§åˆæœŸçŠ¶æ…‹ã‚’æ­£ã—ãè¨­å®š
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å®Ÿæ–½
    return new TranscriptionSession(...);
  }
}

// âœ… æ¨å¥¨ã•ã‚Œã‚‹ä½¿ã„æ–¹
const session = TranscriptionSession.create(...);

// âŒ ã“ã‚Œã¯ã§ããªã„ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰
const session = new TranscriptionSession(...);
```

### Q4: ãƒ†ã‚¹ãƒˆã¯ã©ã†æ›¸ãã®ï¼Ÿ

**A**: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ†ã‚¹ãƒˆã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ï¼š

```typescript
describe("AudioFileMeta", () => {
  it("æ­£ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã§ä½œæˆã§ãã‚‹", () => {
    const meta = new AudioFileMeta("test.m4a", "audio/m4a", 1000, 60);
    expect(meta.sizeBytes).toBe(1000);
  });

  it("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹ã¨ã‚¨ãƒ©ãƒ¼", () => {
    expect(() => {
      new AudioFileMeta("huge.m4a", "audio/m4a", 200000000, 60);
    }).toThrow(InvalidAudioFileError);
  });
});
```

**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAPIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã«ä¾å­˜ã—ãªã„ã®ã§ã€ãƒ†ã‚¹ãƒˆãŒé€Ÿã„ï¼**

### Q5: å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã©ã†ä½¿ã†ã®ï¼Ÿ

**A**: Applicationå±¤ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ã§ä½¿ã„ã¾ã™ï¼š

```typescript
// Applicationå±¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
class TranscribeAudioUseCase {
  async execute(command: TranscribeAudioCommand): Promise<TranscriptionResult> {
    // 1. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    const audioMeta = new AudioFileMeta(
      command.fileName,
      command.mimeType,
      command.sizeBytes,
      command.durationSeconds
    );
    const engine = TranscriptionEngine.fromString(command.engine);
    const session = TranscriptionSession.create(audioMeta, engine, new Date());

    // 2. å‡¦ç†é–‹å§‹
    session.startProcessing(new Date());

    // 3. æ–‡å­—èµ·ã“ã—å®Ÿè¡Œ
    const text = await this.speechService.transcribe(...);
    const result = new TranscriptionText(text);

    // 4. å®Œäº†
    session.complete(result, new Date());

    return this.toDTO(session);
  }
}
```

---

## ã¾ã¨ã‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®å½¹å‰²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®è²¬å‹™                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®å®šç¾©                  â”‚
â”‚  âœ… çŠ¶æ…‹é·ç§»ã®ç®¡ç†                       â”‚
â”‚  âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                       â”‚
â”‚  âœ… ä¸å¤‰æ¡ä»¶ã®ä¿è¨¼                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆInfrastructureï¼‰â”‚
â”‚  âŒ APIå‘¼ã³å‡ºã—ï¼ˆInfrastructureï¼‰        â”‚
â”‚  âŒ UIè¡¨ç¤ºï¼ˆPresentationï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é–¢ä¿‚

```
                TranscriptionSessionï¼ˆä¸­å¿ƒï¼‰
                        â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                 â†“                 â†“
  SessionId      AudioFileMeta    TranscriptionEngine
                                         â†“
                              TranscriptionStatus
                                         â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â†“                                 â†“
              TranscriptionText                 TranscriptionFailure
                   (æˆåŠŸæ™‚)                          (å¤±æ•—æ™‚)
```

### å­¦ç¿’ã®ã‚³ãƒ„

1. **å°‘ã—ãšã¤ç†è§£ã™ã‚‹**: å…¨éƒ¨ä¸€åº¦ã«ç†è§£ã—ã‚ˆã†ã¨ã—ãªã„
2. **å®Ÿéš›ã«å‹•ã‹ã™**: ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦è©¦ã—ã¦ã¿ã‚‹
3. **ãƒ†ã‚¹ãƒˆã‚’æ›¸ã**: ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¨ç†è§£ãŒæ·±ã¾ã‚‹
4. **å®Ÿä¸–ç•Œã«ä¾‹ãˆã‚‹**: è‡ªåˆ†ã®èº«è¿‘ãªä¾‹ã«ç½®ãæ›ãˆã¦è€ƒãˆã‚‹

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã‚‚åˆ†ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã€é æ…®ãªãè³ªå•ã—ã¦ãã ã•ã„ï¼** ğŸ“
