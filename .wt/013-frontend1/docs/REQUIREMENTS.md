# DDD学習サービス 要件定義書

## 1. サービス概要

### 1.1 ミッションステートメント

> **既にWeb開発の基礎があるエンジニアが、実務レベルで使えるドメイン駆動設計（DDD）の考え方と設計スキルを、小さな実践プロジェクトを通じて身につけるためのオンライン学習サービス**

### 1.2 ビジョンとプロダクト戦略

| 観点 | 内容 |
|------|------|
| **ビジョン（将来像）** | Web開発の基礎から高度な設計手法まで、段階的に学べる総合学習プラットフォーム |
| **v1プロダクト（今回）** | DDD実践特化コース。前提知識がある人向けにDDDの本質を学べるサービス |

```
将来のロードマップ:
┌─────────────────────────────────────────────────────────────┐
│ レベル1: Web開発基礎        [将来拡張]                        │
│ ├── Next.js入門                                              │
│ ├── TypeScript基礎                                           │
│ └── React Hooks                                              │
├─────────────────────────────────────────────────────────────┤
│ レベル2: 設計の基礎          [将来拡張]                        │
│ ├── クリーンコード                                            │
│ ├── SOLID原則                                                │
│ └── デザインパターン入門                                       │
├─────────────────────────────────────────────────────────────┤
│ レベル3: DDD実践             ★ v1で実装 ★                    │
│ ├── 戦略的設計                                               │
│ ├── 戦術的設計                                               │
│ └── 実践プロジェクト                                          │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 背景
- DDDは複雑なビジネスドメインを扱うソフトウェア開発において有効な手法
- 書籍だけでは実践的な理解が難しい
- 実際にコードを書きながら学ぶことで定着率が向上する
- **コア価値は「DDDの実践を学べること」に集中する**

---

## 2. ターゲットユーザー

### 2.1 前提条件

本サービス（v1）の受講には以下の前提知識が必要：

| カテゴリ | 必要なスキル |
|---------|-------------|
| TypeScript | 基本的な型定義、クラス、インターフェースの理解 |
| Next.js | App Routerでの基本的なページ作成経験 |
| オブジェクト指向 | クラス、継承、カプセル化の概念理解 |

### 2.2 ペルソナ

#### ペルソナ1: 田中さん（実務2年目エンジニア）

| 項目 | 内容 |
|------|------|
| **年齢・職種** | 26歳、Webアプリケーションエンジニア |
| **経験** | TypeScript 1.5年、Next.js 1年 |
| **現在の状況** | 社内ツールの開発を担当。機能追加のたびにコードが複雑化し、どこに何を書くべきか迷うことが増えた |
| **課題** | 「動くコード」は書けるが、「良い設計」が分からない。DDDという言葉は聞いたことがあるが、何から始めればいいか分からない |
| **学習目標** | ドメインロジックの整理方法を学び、保守しやすいコードを書けるようになりたい |
| **学習スタイル** | 実際にコードを書きながら理解したい。抽象的な説明だけでは頭に入らない |

#### ペルソナ2: 鈴木さん（チームリーダー）

| 項目 | 内容 |
|------|------|
| **年齢・職種** | 32歳、テックリード |
| **経験** | TypeScript 4年、チームマネジメント 2年 |
| **現在の状況** | 5人のチームでBtoBサービスを開発中。コードレビューで「これはドメイン層？アプリケーション層？」と迷うことが多い |
| **課題** | DDDの本は読んだが、チームに導入する具体的な方法が分からない。実践例が欲しい |
| **学習目標** | DDDの原則をチームに説明でき、コードレビューで明確な指針を示せるようになりたい |
| **学習スタイル** | 概念→実装例→自分で試す、の順で学びたい |

### 2.3 前提知識ガイド（レベル1-2の代替）

v1では以下のリソースへの導線を提供：

```
📚 このコースを最大限活かすための事前準備

□ TypeScript
  - 公式ドキュメント: https://www.typescriptlang.org/docs/
  - 推奨: 「プロを目指す人のためのTypeScript入門」

□ Next.js
  - 公式チュートリアル: https://nextjs.org/learn
  - App Routerの基本が分かればOK

□ オブジェクト指向
  - クラスの定義と使い方が分かる
  - 継承、インターフェースの概念が分かる

□ 理解度チェックリスト
  - [ ] TypeScriptでクラスを定義できる
  - [ ] インターフェースで型を定義できる
  - [ ] Next.jsでページを作成できる
  - [ ] async/awaitを使った非同期処理が書ける
```

---

## 3. レベル3: DDD実践コース（v1スコープ）

### 3.1 コース構成

```
DDD実践コース（全3部・15章 + ケーススタディ集）
│
├─ 第1部: DDDの基礎概念（戦略的設計）  ★v1 Phase 1★
│   ├── Chapter 1: ドメインとは何か
│   │   └── なぜDDDが必要なのか、ドメインエキスパートとの協業
│   ├── Chapter 2: ユビキタス言語
│   │   └── チームで共通言語を作る、コードに反映する
│   ├── Chapter 3: 境界づけられたコンテキスト
│   │   └── システムを分割する単位、コンテキストの見つけ方
│   └── Chapter 4: コンテキストマップ
│       └── コンテキスト間の関係、統合パターン
│
├─ 第2部: 戦術的設計パターン  ★v1 Phase 2★
│   ├── Chapter 5: 値オブジェクト
│   │   └── 不変性、等価性、自己検証
│   ├── Chapter 6: エンティティ
│   │   └── 同一性、ライフサイクル、識別子
│   ├── Chapter 7: ドメインサービス
│   │   └── エンティティに属さないドメインロジック
│   ├── Chapter 8: 集約
│   │   └── 整合性の境界、集約ルート、不変条件
│   ├── Chapter 9: リポジトリ
│   │   └── 永続化の抽象化、コレクションのような振る舞い
│   ├── Chapter 10: ファクトリ
│   │   └── 複雑なオブジェクト生成、生成ルールのカプセル化
│   └── Chapter 11: 仕様パターン
│       └── 複雑なビジネスルールの表現、組み合わせ可能な条件
│
├─ 第3部: アーキテクチャパターン  ★v1 Phase 2★
│   ├── Chapter 12: レイヤードアーキテクチャ
│   │   └── 4層構造、依存関係のルール
│   ├── Chapter 13: クリーンアーキテクチャ
│   │   └── 依存性逆転、ユースケース層
│   ├── Chapter 14: ヘキサゴナルアーキテクチャ
│   │   └── ポートとアダプター、テスト容易性
│   └── Chapter 15: CQRS/イベントソーシング
│       └── コマンドとクエリの分離、イベント駆動
│
├─ ケーススタディ集（別枠・Phase 2以降）
│   ├── Case 1: ECサイトの設計
│   │   ├── 1-1. 商品・カタログのモデリング
│   │   ├── 1-2. 注文・決済フローの設計
│   │   ├── 1-3. 在庫管理と整合性
│   │   └── 1-4. 境界の見直しとリファクタリング
│   ├── Case 2: 予約システムの設計
│   │   ├── 2-1. 予約と空き状況のモデリング
│   │   └── 2-2. キャンセルポリシーの実装
│   └── Case 3: 学習管理システムの設計（自己参照）
│       └── 本サービス自体のアーキテクチャ解説
│
└─ ボーナス: この学習サービスのDDD設計（MVP完成後に追加）
    └── 「今あなたが使っているサービスの設計を解説」
        ├── アーキテクチャ概要
        ├── 境界づけられたコンテキストの実例
        ├── ドメインモデルの実装
        └── GitHubリポジトリへのリンク
```

**ケーススタディ集の方針:**
- 第1-3部で学んだパターンを実践的に適用する演習
- 各ケースは複数のレッスンで構成（1ケース = 2-4レッスン）
- Phase 2以降で段階的に追加
- 「ボーナス: この学習サービスのDDD設計」は本サービス自体が教材となる自己参照的コンテンツ

### 3.2 各チャプターの構成

1つのチャプターは以下の要素で構成：

| 要素 | 説明 | 所要時間目安 |
|------|------|-------------|
| **概念説明** | 図解を含む解説テキスト | 10-15分 |
| **コード例** | TypeScriptによる実装サンプル | 5-10分 |
| **ハンズオン演習** | 実際にコードを書く課題 | 15-30分 |
| **理解度クイズ** | 選択式の確認問題（5問） | 5分 |

### 3.3 コンテンツ形式

| 形式 | 説明 |
|------|------|
| 解説テキスト | 概念の説明、図解（Mermaid形式） |
| コード例 | TypeScriptによる実装例（シンタックスハイライト付き） |
| インタラクティブ演習 | ブラウザ上でコードを編集・実行（Phase 2） |
| クイズ | 理解度確認のための選択式問題 |
| ハンズオン課題 | 実際にコードを書く演習（ローカル環境で実行） |

---

## 4. 機能要件（v1スコープ）

### 4.1 MVP（Phase 1）機能

#### 4.1.1 学習コンテンツ機能
- [ ] コース一覧表示
- [ ] チャプター一覧表示
- [ ] レッスン内容表示（Markdown形式）
- [ ] コード例表示（シンタックスハイライト）
- [ ] 前後のレッスンへのナビゲーション

#### 4.1.2 学習進捗管理機能
- [ ] レッスン完了マーク
- [ ] チャプター進捗率表示
- [ ] 全体進捗率表示
- [ ] 学習履歴の保存（ローカルストレージ）

#### 4.1.3 クイズ機能
- [ ] 選択式問題の表示
- [ ] 回答の正誤判定
- [ ] スコア表示
- [ ] 解説表示

### 4.2 Phase 2機能（将来）

- コード実行環境（下記いずれかを選択）
  - **推奨A: ローカル実行** - GitHubリポジトリのブランチを用意し、ユーザーの手元（VSCode）で実行
    - 「実務レベル」を謳うサービスとして、ローカル環境での開発体験の方が学習効果が高い
  - **推奨B: StackBlitz/CodeSandbox埋め込み** - 外部サービスの埋め込みを利用（自前実装しない）
  - ~~WebContainer自前実装~~ → 技術的難易度が高く、MVPには不要
- ユーザー認証・アカウント管理
- クラウドへの進捗同期

### 4.3 Phase 3機能（将来）

- 学習分析ダッシュボード
- コミュニティ機能（Q&A）
- メンタリング機能

---

## 5. 非機能要件

### 5.1 性能要件
| 項目 | 要件 |
|------|------|
| ページ読み込み時間 | 3秒以内 |
| 同時接続ユーザー数 | 100人（Phase 1では考慮不要） |

### 5.2 可用性要件
| 項目 | 要件 |
|------|------|
| 稼働率 | 99%以上（Vercelに依存） |

### 5.3 セキュリティ要件
- HTTPS通信の強制
- XSS対策（サニタイズ）
- 認証機能はPhase 2以降

### 5.4 保守性要件
- DDDアーキテクチャの採用（自己参照的な設計）
- テストカバレッジ80%以上
- ドキュメントの整備

---

## 6. ドメインモデル設計

### 6.1 境界づけられたコンテキスト

```
┌─────────────────────────────────────────────────────────────────┐
│                     DDD Learning Service                        │
├─────────────────┬─────────────────┬─────────────────────────────┤
│   学習コンテンツ    │    学習進捗      │      ユーザー管理          │
│   コンテキスト     │   コンテキスト    │      コンテキスト          │
│   ★v1スコープ★   │   ★v1スコープ★  │      [Phase 2]            │
├─────────────────┼─────────────────┼─────────────────────────────┤
│ - Course        │ - Progress      │ - User                      │
│ - Chapter       │ - QuizResult    │ - Profile                   │
│ - Lesson        │                 │ - Credential                │
│ - Quiz          │                 │                             │
│ - Question      │                 │                             │
└─────────────────┴─────────────────┴─────────────────────────────┘
```

### 6.2 集約設計

#### 6.2.1 学習コンテンツコンテキスト

```typescript
// Course集約
Course (集約ルート)
├── CourseId: 値オブジェクト
├── Title: 値オブジェクト
├── Description: string
├── Level: LearningLevel (enum: BEGINNER | INTERMEDIATE | ADVANCED)
└── Chapters: Chapter[] (エンティティ)
    ├── ChapterId
    ├── Title
    ├── Order: number
    └── Lessons: Lesson[] (エンティティ)
        ├── LessonId
        ├── Title
        ├── Content: MarkdownContent (値オブジェクト)
        ├── CodeExamples: CodeExample[] (値オブジェクト)
        └── QuizId: QuizId | null (0..1の関係)
            └── Quiz（別途取得可能なエンティティ）

// Quiz（Lessonから参照されるが、独立して取得可能）
Quiz (エンティティ)
├── QuizId
├── LessonId (逆参照用)
└── Questions: Question[] (値オブジェクト)
    ├── QuestionId
    ├── Text: string
    ├── Options: QuizOption[] (値オブジェクト)
    └── CorrectOptionIndex: number
```

**Lesson と Quiz の関係性:**
- Lesson は Quiz を 0個または1個 持つ（0..1の関係）
- Lesson は QuizId のみを保持し、Quiz の詳細は別途取得
- `lesson.hasQuiz()` で Quiz の有無を判定可能
- Quiz は独立したエンティティとして取得・操作可能（スコア計算など）

#### 6.2.2 学習進捗コンテキスト

```typescript
// Progress集約
Progress (集約ルート)
├── ProgressId: 値オブジェクト
├── CourseId: 値オブジェクト
├── CompletedLessons: LessonId[] (値オブジェクト)
├── QuizResults: QuizResult[] (エンティティ)
│   ├── QuizId
│   ├── Score: Score (値オブジェクト)
│   └── CompletedAt: Date
└── LastAccessedAt: Date
```

### 6.3 値オブジェクト例

```typescript
// スコア値オブジェクト
// ※ 本プロジェクトでは例外ベースのバリデーションを採用（Result型は使用しない）
class Score {
  private constructor(
    private readonly _correct: number,
    private readonly _total: number
  ) {}

  static create(correct: number, total: number): Score {
    if (correct < 0) {
      throw new Error('Correct answers cannot be negative');
    }
    if (total <= 0) {
      throw new Error('Total questions must be positive');
    }
    if (correct > total) {
      throw new Error('Correct answers cannot exceed total');
    }
    return new Score(correct, total);
  }

  get correct(): number {
    return this._correct;
  }

  get total(): number {
    return this._total;
  }

  get percentage(): number {
    return Math.round((this._correct / this._total) * 100);
  }

  isPassing(threshold: number = 70): boolean {
    return this.percentage >= threshold;
  }

  equals(other: Score): boolean {
    return this._correct === other._correct && this._total === other._total;
  }
}
```

### 6.4 仕様パターン例

```typescript
// レッスン解放条件の仕様
class LessonUnlockSpecification {
  isSatisfiedBy(lesson: Lesson, progress: Progress, course: Course): boolean {
    // 最初のレッスンは常に解放
    if (lesson.isFirst()) return true;

    // 前のレッスンが完了していれば解放
    const previousLesson = course.getPreviousLesson(lesson);
    return progress.hasCompletedLesson(previousLesson.id);
  }
}

// チャプター完了条件の仕様
class ChapterCompletionSpecification {
  isSatisfiedBy(chapter: Chapter, progress: Progress): boolean {
    return chapter.lessons.every(lesson =>
      progress.hasCompletedLesson(lesson.id)
    );
  }
}
```

---

## 7. 画面構成（v1）

### 7.1 画面一覧

| 画面ID | 画面名 | 説明 | 優先度 |
|--------|--------|------|--------|
| TOP-001 | トップページ | サービス紹介、コース一覧へのCTA | 必須 |
| COURSE-001 | コース詳細 | チャプター一覧、進捗表示 | 必須 |
| LESSON-001 | レッスン画面 | コンテンツ表示、コード例 | 必須 |
| QUIZ-001 | クイズ画面 | 選択式問題、結果表示 | 必須 |
| PROGRESS-001 | 進捗ダッシュボード | 全体進捗、学習履歴 | 任意 |

### 7.2 画面遷移図

```
[トップページ] ─→ [コース詳細] ─→ [レッスン画面] ─→ [クイズ画面]
      │                │                │               │
      │                │                └───────────────┘
      │                │                      (次へ/前へ)
      │                └─→ [進捗ダッシュボード]
      │
      └─→ [前提知識ガイド] (外部リンク集)
```

### 7.3 URL構造

```
/                           # トップページ
/courses                    # コース一覧（将来）
/courses/ddd-practice       # DDD実践コース詳細
/courses/ddd-practice/chapters/1              # 第1部
/courses/ddd-practice/chapters/1/lessons/1    # Chapter 1: ドメインとは何か
/courses/ddd-practice/chapters/1/lessons/1/quiz  # クイズ
/progress                   # 進捗ダッシュボード

# 将来のレベル構造
/level/1                    # レベル1: Web開発基礎（準備中）
/level/2                    # レベル2: 設計の基礎（準備中）
/level/3                    # レベル3: DDD実践 → /courses/ddd-practice にリダイレクト
```

---

## 8. 技術スタック

### 8.1 フロントエンド
| 技術 | バージョン | 用途 |
|------|------------|------|
| Next.js | 15.x | Reactフレームワーク |
| React | 19.x | UIライブラリ |
| TypeScript | 5.x | 型安全な開発 |
| Tailwind CSS | 3.x | スタイリング |
| react-markdown | - | Markdownレンダリング |
| react-syntax-highlighter | - | コードハイライト |

### 8.2 バックエンド（Phase 1）
| 技術 | 用途 |
|------|------|
| 静的JSON/MDファイル | コンテンツデータ |
| LocalStorage | 進捗保存 |

### 8.3 バックエンド（Phase 2以降）
| 技術 | バージョン | 用途 |
|------|------------|------|
| Next.js API Routes | - | API実装 |
| Prisma | 5.x | ORM |
| Supabase | - | 認証・データベース |

### 8.4 インフラ
| 技術 | 用途 |
|------|------|
| Vercel | ホスティング |
| GitHub | ソースコード管理 |

### 8.5 開発ツール
| ツール | 用途 |
|--------|------|
| ESLint | 静的解析 |
| Prettier | コードフォーマット |
| Vitest | ユニットテスト |

---

## 9. 開発フェーズ

### Phase 1: MVP（v1.0）
**目標**: DDDの学習コンテンツを閲覧でき、進捗を追跡できる

- [ ] プロジェクトセットアップ（DDD構造）
- [ ] トップページ
- [ ] コース詳細ページ
- [ ] レッスン表示ページ
- [ ] クイズ機能
- [ ] 進捗管理（LocalStorage）
- [ ] 第1部のコンテンツ作成（Chapter 1-4: 戦略的設計）

### Phase 2: コンテンツ拡充（v1.1）
**目標**: 戦術的設計パターンとアーキテクチャパターンの学習

- [ ] 第2部のコンテンツ作成（Chapter 5-11: 戦術的設計パターン）
- [ ] 第3部のコンテンツ作成（Chapter 12-15: アーキテクチャパターン）
- [ ] ユーザー認証・アカウント管理
- [ ] クラウド進捗同期
- [ ] ハンズオン用GitHubリポジトリ整備（各チャプターのブランチ）

### Phase 3: ケーススタディ集（v1.2）
**目標**: 実践的な設計演習の提供

- [ ] Case 1: ECサイトの設計（4レッスン）
- [ ] Case 2: 予約システムの設計（2レッスン）
- [ ] Case 3: 学習管理システムの設計（自己参照）
- [ ] ボーナス: この学習サービスのDDD設計
- [ ] StackBlitz/CodeSandbox埋め込み（オプション）

### Phase 4: 拡張機能（v2.0）
- レベル1, 2のコース追加
- コミュニティ機能（Q&A）
- 学習分析ダッシュボード
- メンタリング機能

---

## 10. 用語集（ユビキタス言語）

| 用語 | 定義 |
|------|------|
| コース (Course) | 特定のスキルを体系的に学ぶ学習単位（例: DDD実践コース） |
| チャプター (Chapter) | コースを構成する大きな区切り（例: 第1部 DDDの基礎概念） |
| レッスン (Lesson) | 1つの概念を学ぶ最小単位（例: Chapter 1: ドメインとは何か） |
| クイズ (Quiz) | レッスン末尾の理解度確認問題 |
| 進捗 (Progress) | ユーザーの学習の進み具合 |
| スコア (Score) | クイズの正答数と総問題数 |
| 修了 (Completion) | レッスンまたはチャプターの全要件を満たした状態 |
| レベル (Level) | 学習の難易度段階（1: 基礎、2: 中級、3: 上級） |

---

## 11. 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|------------|----------|--------|
| 2024-11-22 | 1.0.0 | 初版作成 | - |
| 2024-11-22 | 1.1.0 | A+B二段構え方針に更新、ペルソナ追加、v1スコープ明確化 | - |
| 2025-11-22 | 1.2.0 | レビュー反映: 第4部→ケーススタディ集に変更、Phase再構成、Lesson-Quiz関係明確化、エラー表現を例外ベースに統一 | - |
