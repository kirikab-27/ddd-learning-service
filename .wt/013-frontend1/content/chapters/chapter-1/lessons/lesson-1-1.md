# なぜDDDが必要なのか

## 概要

このレッスンでは、DDDが解決しようとする問題と、DDDを採用するメリットについて学びます。
なぜ従来のソフトウェア開発アプローチでは複雑なビジネスロジックを扱うのが難しいのか、
そしてDDDがどのようにその課題を解決するのかを理解しましょう。

## ソフトウェア開発の課題

### 複雑なビジネスロジック

現代のソフトウェア開発では、ビジネスロジックが非常に複雑になることがあります。
例えば、ECサイトでは以下のような複雑なルールが存在します：

- 会員ランクによる割引率の違い
- 在庫状況に応じた注文制限
- 配送先による送料計算
- キャンペーン期間中の特別ルール

これらのルールが適切に整理されていないと、**スパゲッティコード**が生まれます。

```typescript
// 悪い例：ビジネスルールが散在している
function processOrder(order, user, inventory) {
  let discount = 0;
  if (user.rank === 'gold') {
    discount = 0.1;
  } else if (user.rank === 'silver') {
    discount = 0.05;
  }
  // ...さらに多くの条件分岐が続く
}
```

### 技術とビジネスの乖離

開発者が使う技術的な用語と、ビジネス側が使う用語が異なると、
コミュニケーションに齟齬が生まれます。

| ビジネス側の言葉 | 開発者の言葉 |
|----------------|------------|
| 「顧客」 | 「Userテーブル」 |
| 「注文を確定する」 | 「statusフラグを1にする」 |
| 「在庫を引き当てる」 | 「inventory -= quantity」 |

この乖離が大きくなると、ビジネス要件の誤解や実装ミスにつながります。

## DDDとは

**ドメイン駆動設計（Domain-Driven Design）** は、Eric Evansが2003年に提唱した
ソフトウェア設計手法です。

DDDの核心は：

> ソフトウェアの複雑さの根本原因は、**ドメイン（ビジネスの問題領域）** にある。
> したがって、ドメインを深く理解し、それをコードに反映させることが重要である。

### DDDの3つの柱

1. **ユビキタス言語**: ビジネスと開発で共通の言葉を使う
2. **モデル駆動設計**: ドメインモデルをコードの中心に据える
3. **境界づけられたコンテキスト**: 複雑さを適切な単位で分離する

## DDDのメリット

### 1. ビジネスと技術の共通理解

DDDでは、ビジネスエキスパートと開発者が同じ言葉（ユビキタス言語）を使います。

```typescript
// DDDを適用した例：ビジネス用語がそのままコードに
class Order {
  confirm(): void {
    if (!this.canBeConfirmed()) {
      throw new OrderCannotBeConfirmedException();
    }
    this.status = OrderStatus.Confirmed;
  }
}
```

### 2. 変更に強い設計

ドメインモデルを中心に設計することで、ビジネスルールの変更に柔軟に対応できます。
技術的な詳細（データベース、フレームワーク）はドメインの外側に配置されるため、
ビジネスロジックに影響を与えずに技術を変更できます。

### 3. チームコミュニケーションの改善

共通言語があることで、以下が改善されます：

- 要件定義の精度向上
- コードレビューの効率化
- 新メンバーのオンボーディング

## まとめ

- **スパゲッティコード**や**ビジネスルールの散在**は、複雑なソフトウェア開発の大きな課題
- **技術とビジネスの乖離**は、コミュニケーションエラーや実装ミスを引き起こす
- **DDD**は、ドメインを中心に据えた設計手法で、これらの課題を解決する
- DDDにより、**共通理解**、**変更への強さ**、**コミュニケーション改善**が実現できる
