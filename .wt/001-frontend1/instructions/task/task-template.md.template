<!-- Task Assignment Template -->
<!--
  Usage: Replace all [PLACEHOLDERS] with task-specific values

  This template follows Protocol Improvement 3, which has achieved
  11+ consecutive successful completions in BookRAG Manager.

  This file is created by President and sent to Boss1 for task decomposition
  and Worker assignment.
-->

# チケット[TICKET_NUMBER]: [TASK_NAME]

**Version**: [VERSION]
**Priority**: [PRIORITY]
**Target**: [TARGET]
**Estimated Workers**: [NUM_WORKERS] Workers
**Estimated Duration**: [ESTIMATED_DURATION]
**President**: President
**Boss**: Boss1

<!-- Example from BookRAG Manager:
Ticket: #212
Task: RAGシステム基盤構築（v0.9.0）
Version: v0.9.0
Priority: High
Target: RAG検索機能の実装
Estimated Workers: 6 Workers
Estimated Duration: 1-2日
-->

---

## 🎯 目的

[PURPOSE]

このタスクは、[PROJECT_NAME]における[FEATURE_NAME]の実装を目的としています。

<!-- Example:
このタスクは、BookRAG Managerにおけるセマンティック検索およびRAGシステムの基盤構築を目的としています。
-->

### ビジネス価値

[BUSINESS_VALUE]

<!-- Example:
- ユーザーが書籍を意味的に検索できる
- 類似書籍を自動推薦できる
- 書籍データベースの価値を最大化
- ユーザー体験の大幅な向上
-->

### 技術的目標

[TECHNICAL_GOALS]

<!-- Example:
- Supabase Vector拡張機能の導入
- OpenAI Embeddings APIの統合
- Vector Database層の実装
- RAG検索ロジックの実装
- Similar Books UIの実装
- Semantic Search UIの実装
-->

---

## 📋 要件

### 機能要件

[FUNCTIONAL_REQUIREMENTS]

<!-- Example:
1. **Supabase Vector設定**
   - pgvector拡張機能の有効化
   - embedding列の追加（vector(1536)型）
   - ベクトル類似度検索用インデックス作成

2. **OpenAI Embeddings API統合**
   - text-embedding-3-smallモデルの使用
   - 書籍メタデータのベクトル化
   - バッチ処理対応

3. **Vector Database実装**
   - Supabase関数: match_books_by_embedding
   - 類似度検索クエリ
   - エラーハンドリング

4. **RAG検索ロジック**
   - セマンティック検索関数
   - クエリのベクトル化
   - 検索結果のランキング

5. **UI実装**
   - Similar Books表示コンポーネント
   - Semantic Search入力UI
   - 検索結果表示
-->

### 非機能要件

[NON_FUNCTIONAL_REQUIREMENTS]

<!-- Example:
- TypeScript エラー: 0件
- ビルド: 成功
- レスポンス時間: 検索2秒以内
- エラーハンドリング: 全API呼び出しで実装
- ログ: 重要な処理で実装
-->

### 技術スタック

- **[TECH_STACK_1]**: [VERSION_1]
- **[TECH_STACK_2]**: [VERSION_2]
- **[TECH_STACK_3]**: [VERSION_3]

<!-- Example:
- **Next.js**: 14.2.17
- **TypeScript**: 5.x
- **Supabase**: Latest (Vector拡張)
- **OpenAI**: 4.x (text-embedding-3-small)
-->

---

## 🏗️ 実装計画

### Worker割り当て

このタスクは[NUM_WORKERS]名のWorkerに分割されます。各Workerは独立したタスクを担当し、Tier構造に基づいて並列または順次実行します。

| Worker | 担当タスク | 主要成果物 | 依存関係 | Tier |
|--------|-----------|-----------|---------|------|
| Worker1 | [TASK_1] | [DELIVERABLE_1] | なし | Tier1 |
| Worker2 | [TASK_2] | [DELIVERABLE_2] | なし | Tier1 |
| Worker3 | [TASK_3] | [DELIVERABLE_3] | Worker1完了後 | Tier2 |
| Worker4 | [TASK_4] | [DELIVERABLE_4] | Worker3完了後 | Tier3 |
| Worker5 | [TASK_5] | [DELIVERABLE_5] | Worker4完了後 | Tier4 |
| Worker6 | [TASK_6] | [DELIVERABLE_6] | Worker4完了後 | Tier4 |

<!-- Example from BookRAG Manager チケット212:
| Worker | 担当タスク | 主要成果物 | 依存関係 | Tier |
|--------|-----------|-----------|---------|------|
| Worker1 | Supabase Vector設定 | migration SQL | なし | Tier1 |
| Worker2 | OpenAI Embeddings API統合 | src/lib/embeddings.ts | なし | Tier1 |
| Worker3 | Vector Database実装 | src/lib/vector-db.ts | Worker1完了後 | Tier2 |
| Worker4 | RAG検索ロジック実装 | src/lib/rag-search.ts | Worker3完了後 | Tier3 |
| Worker5 | Similar Books UI実装 | components/SimilarBooks.tsx | Worker4完了後 | Tier4 |
| Worker6 | Semantic Search UI実装 | components/SemanticSearch.tsx | Worker4完了後 | Tier4 |
-->

### Tier構造（依存関係）

[TIER_STRUCTURE]

<!-- Example from BookRAG Manager チケット212:
```
Tier1: 基盤層（並列実行可能）
├─ Worker1: Supabase Vector設定
└─ Worker2: OpenAI Embeddings API統合

Tier2: データベース層（Tier1依存）
└─ Worker3: Vector Database実装
   ↑ Worker1 (Supabase設定) が必要

Tier3: ビジネスロジック層（Tier2依存）
└─ Worker4: RAG検索ロジック実装
   ↑ Worker3 (Vector DB) が必要

Tier4: UI層（Tier3依存、並列実行可能）
├─ Worker5: Similar Books UI実装
└─ Worker6: Semantic Search UI実装
   ↑ 両方とも Worker4 (RAG検索) が必要
```

**実行順序**:
1. Tier1の2 Workers（Worker1, Worker2）を並列で開始
2. Tier1完了後、Tier2の1 Worker（Worker3）を開始
3. Tier2完了後、Tier3の1 Worker（Worker4）を開始
4. Tier3完了後、Tier4の2 Workers（Worker5, Worker6）を並列で開始
5. 全Worker完了後、Boss1が統合作業を実施
-->

### 並列化戦略

- **Tier1**: [NUM_TIER1_WORKERS] Workers（完全並列）
- **Tier2**: [NUM_TIER2_WORKERS] Workers（Tier1依存、並列可能）
- **Tier3**: [NUM_TIER3_WORKERS] Workers（Tier2依存、並列可能）
- **Tier4**: [NUM_TIER4_WORKERS] Workers（Tier3依存、並列可能）

**期待効果**: 依存関係を明確にしつつ、並列実行を最大化することで開発期間を短縮

---

## 📝 Worker詳細仕様

### 全Worker共通の注意事項

#### ⚠️ 作業開始前の必須確認
全Workerは作業開始前に以下を必ず実施すること:
1. **pwd でリポジトリパス確認**
   ```bash
   pwd
   # 期待される出力: [REPO_PATH]
   ```
2. **指示書を最後まで読了**
3. **DoD（Definition of Done）を理解**

#### ⚠️ 作業完了前の必須確認
全Workerは完了報告前に以下を必ず実施すること:
1. **ls -la で成果物ファイル実在確認**
2. **git status で変更確認**
3. **git commit 実行**
4. **git log -1 --stat でコミット内容確認**
5. **agent-send.sh で Boss1 に完了報告**

**これらの確認を怠ると、Worker5のような問題が再発します**

---

### Worker1: [WORKER1_TASK_NAME]

#### 担当内容

[WORKER1_DESCRIPTION]

<!-- Example:
Supabase DatabaseにVector拡張機能を追加し、書籍テーブルに埋め込みベクトル列を追加します。
-->

#### 実装仕様

[WORKER1_SPEC]

<!-- Example:
1. pgvector拡張機能の有効化
2. booksテーブルにembedding列追加（vector(1536)型）
3. ベクトル類似度検索用インデックス作成（ivfflat）
4. match_books_by_embedding関数作成（RPC用）
-->

#### 成果物

- [DELIVERABLE_1]
- [DELIVERABLE_2]

<!-- Example:
- supabase/migrations/[timestamp]_add_vector_support.sql
- README更新（Vector機能の説明）
-->

#### DoD

- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] [DOD_ITEM_3]
- [ ] TypeScriptエラー: 0件（該当する場合）
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker1-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

### Worker2: [WORKER2_TASK_NAME]

#### 担当内容

[WORKER2_DESCRIPTION]

#### 実装仕様

[WORKER2_SPEC]

#### 成果物

- [DELIVERABLE_1]
- [DELIVERABLE_2]

#### DoD

- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] [DOD_ITEM_3]
- [ ] TypeScriptエラー: 0件
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker2-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

<!-- Add more Worker sections as needed (Worker3-6) -->

### Worker3: [WORKER3_TASK_NAME]

#### 担当内容
[WORKER3_DESCRIPTION]

#### 実装仕様
[WORKER3_SPEC]

#### 成果物
- [DELIVERABLE_1]
- [DELIVERABLE_2]

#### DoD
- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] TypeScriptエラー: 0件
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker3-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

### Worker4: [WORKER4_TASK_NAME]

#### 担当内容
[WORKER4_DESCRIPTION]

#### 実装仕様
[WORKER4_SPEC]

#### 成果物
- [DELIVERABLE_1]
- [DELIVERABLE_2]

#### DoD
- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] TypeScriptエラー: 0件
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker4-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

### Worker5: [WORKER5_TASK_NAME]

#### 担当内容
[WORKER5_DESCRIPTION]

#### 実装仕様
[WORKER5_SPEC]

#### 成果物
- [DELIVERABLE_1]
- [DELIVERABLE_2]

#### DoD
- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] TypeScriptエラー: 0件
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker5-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

### Worker6: [WORKER6_TASK_NAME]

#### 担当内容
[WORKER6_DESCRIPTION]

#### 実装仕様
[WORKER6_SPEC]

#### 成果物
- [DELIVERABLE_1]
- [DELIVERABLE_2]

#### DoD
- [ ] [DOD_ITEM_1]
- [ ] [DOD_ITEM_2]
- [ ] TypeScriptエラー: 0件
- [ ] 完了レポート作成（runs/[TICKET_NUMBER]/worker6-report.md）
- [ ] Boss1に完了報告送信

**DoD目標**: X/X (100%)

---

## ✅ Definition of Done (DoD)

### 全体DoD

このタスクは以下の全項目を満たした時点で完了とみなします：

#### Worker完了条件
- [ ] 全Worker（Worker1-[NUM_WORKERS]）から完了報告を受信
- [ ] 全Worker個別DoD 100%達成を確認
- [ ] 各Workerの成果物をレビュー完了

#### 統合作業完了条件
- [ ] Boss1による統合作業完了
- [ ] Worker間のインターフェース調整完了
- [ ] 追加実装（統合部分）完了（該当する場合）

#### 品質保証完了条件
- [ ] **TypeScriptエラー: 0件**（npx tsc --noEmit）
- [ ] **ビルドテスト: 成功**（npm run build）
- [ ] **単体テスト: 成功**（該当する場合）
- [ ] **E2Eテスト: 成功**（該当する場合）
- [ ] **動作確認: 完了**（主要機能のマニュアルテスト）

#### Git管理完了条件
- [ ] Git commit完了（Conventional Commits準拠）
- [ ] Commit message適切（"feat: [機能説明]"）
- [ ] Git push完了（[MAIN_BRANCH]へ）
- [ ] ブランチステータス: clean

#### 報告完了条件
- [ ] Boss→President完了報告作成（runs/[TICKET_NUMBER]/boss-to-president-report.md）
- [ ] 完了報告送信（agent-send.sh）

**全体DoD目標**: XX/XX (100%)

---

## 📊 成功指標

### 定量指標

- **新規ファイル数**: [MIN_FILES]-[MAX_FILES] ファイル
- **総行数**: [MIN_LINES]-[MAX_LINES] 行
- **Worker DoD達成率**: 100%（全Worker）
- **TypeScriptエラー**: 0件
- **ビルド成功率**: 100%
- **テスト成功率**: 100%（該当する場合）

<!-- Example from BookRAG Manager チケット212:
- 新規ファイル数: 15ファイル
- 総行数: 2,500行
- Worker DoD達成率: 100%（6/6 Workers）
- TypeScriptエラー: 0件
- ビルド成功率: 100%
-->

### 定性指標

- [ ] コードの可読性: 高（適切な命名、コメント）
- [ ] 保守性: 高（関数分割、型安全性）
- [ ] エラーハンドリング: 適切（全API呼び出し）
- [ ] ログ: 適切（重要な処理で実装）
- [ ] ドキュメント: 充実（README, コメント）

---

## 🧪 テスト要件

### 単体テスト（該当する場合）

[UNIT_TEST_REQUIREMENTS]

<!-- Example:
- embeddings.ts の各関数をテスト
- vector-db.ts の検索機能をテスト
- rag-search.ts のランキングロジックをテスト
-->

### 統合テスト（該当する場合）

[INTEGRATION_TEST_REQUIREMENTS]

<!-- Example:
- Supabase Vector DBとの統合テスト
- OpenAI APIとの統合テスト
- フルフローテスト（書籍追加→ベクトル化→検索）
-->

### E2Eテスト（該当する場合）

[E2E_TEST_REQUIREMENTS]

<!-- Example:
- Similar Books UIの表示テスト
- Semantic Search UIの検索テスト
- 検索結果の正確性テスト
-->

---

## 📚 参考資料

### プロジェクト関連

- **リポジトリ**: [REPO_PATH]
- **技術スタック**: [TECH_STACK]
- **ドキュメント**: [DOCS_PATH]
- **関連チケット**: [RELATED_TICKETS]

### 技術ドキュメント

- **[TECH_DOC_1]**: [URL_1]
- **[TECH_DOC_2]**: [URL_2]
- **[TECH_DOC_3]**: [URL_3]

<!-- Example:
- Supabase Vector: https://supabase.com/docs/guides/ai/vector-columns
- OpenAI Embeddings: https://platform.openai.com/docs/guides/embeddings
- pgvector: https://github.com/pgvector/pgvector
-->

---

## 💡 Boss1への指示

### タスク実行フロー

1. **このタスク定義を読み込む**
   - 全体像を理解
   - Worker割り当てを確認
   - Tier構造を確認

2. **Worker向け指示書を作成**
   - `instructions/worker/task-[TICKET_NUMBER]-worker1.md`
   - `instructions/worker/task-[TICKET_NUMBER]-worker2.md`
   - ... (全Worker分)
   - 各指示書に詳細な実装仕様とDoDを記載

3. **作業ディレクトリを作成**
   ```bash
   cd [REPO_PATH]
   mkdir -p runs/[TICKET_NUMBER]
   ```

4. **Tier1 Workerに指示を送信（並列）**
   ```bash
   bash ./scripts/agent-send.sh worker1 "instructions/worker/task-[TICKET_NUMBER]-worker1.md"
   bash ./scripts/agent-send.sh worker2 "instructions/worker/task-[TICKET_NUMBER]-worker2.md"
   ```

5. **各Tier完了後、次のTierに順次指示送信**

6. **全Worker完了後、統合作業を実施**
   - 成果物の確認
   - インターフェース調整
   - 追加実装（統合部分）
   - 品質チェック（TypeScript, Build, Test）

7. **Git管理**
   ```bash
   git add .
   git commit -m "feat: [機能説明]"
   git push origin [MAIN_BRANCH]
   ```

8. **President への完了報告作成・送信**
   - `runs/[TICKET_NUMBER]/boss-to-president-report.md` 作成
   - agent-send.sh で送信

---

## 🎯 期待される成果

[EXPECTED_OUTCOMES]

<!-- Example:
- ユーザーが書籍を意味的に検索できる機能の実装
- 類似書籍を自動推薦できる機能の実装
- RAGシステムの基盤が完成
- 今後のAI機能拡張の土台が構築される
- ユーザー体験の大幅な向上
-->

---

**Boss1へ**: 上記仕様に基づき、Worker1-[NUM_WORKERS]への指示書作成とタスク実行をお願いします。Protocol Improvement 3に従い、全Worker DoD 100%達成を目指してください。

**重要**:
- 各Workerには必ず指示書ファイルを作成し、agent-send.shで送信してください
- 各WorkerのDoD 100%達成を確認してから次のTierに進んでください
- 統合作業では必ずTypeScriptエラー0件、ビルド成功を確認してください

---

<!-- BookRAG Manager実例 -->
<!--
実例: チケット212（RAGシステム基盤構築）

Project: BookRAG Manager
Ticket: #212 RAGシステム基盤構築（v0.9.0）
Version: v0.9.0
Priority: High
Workers: 6 Workers
Tier Structure: 4 Tiers
Duration: 1日
DoD Achievement: 100% (全Worker完了)
TypeScript Errors: 0
Build: Success
Protocol Success: 11連続成功達成

成果物:
- 新規ファイル: 15ファイル
- 総行数: 2,500行
- 機能:
  * Supabase Vector設定
  * Embeddings API統合
  * Vector DB実装
  * RAG検索ロジック
  * Similar Books UI
  * Semantic Search UI

Tier構造の成功例:
Tier1: Worker1 (Supabase), Worker2 (Embeddings) - 並列実行
Tier2: Worker3 (Vector DB) - Tier1依存
Tier3: Worker4 (RAG Logic) - Tier2依存
Tier4: Worker5 (Similar Books UI), Worker6 (Semantic Search UI) - Tier3依存、並列実行

この構造により、依存関係を明確化しつつ、並列実行を最大化し、
Protocol Improvement 3による11連続成功を達成しました。
-->
