こんにちは今回はですねドメイン駆動設計 まあ通称 ddd に関する資料をいただきました ありがとうございますはいよろしくお願いします これソフトウェア開発の世界でなんか最近またよく耳にするようになった言葉ですけど そうですね正直なところこうつかみどころがないなぁと感じている方も多いん じゃないでしょうか a だと思いますで今回のミッションなんですけどこの ddd っていう設計手法の確信にある考え方ですよ ねはいなぜこう20年近く前の概念が今また注目されているのか そしてあなたが明日から使えるかもしれない何かこう思考のヒント これを資料から一緒に深く掘り下げていきたいなとはいぜひ では早速ですがすごく興味深い一文から始めさせてください 資料にですねソフトウェア開発者は利用者を取り巻く世界について 基本的に無知であるとはいちょっとドキッとするような前提から話が始まっているんです これ一体どういう意図なんでしょうか そこがですね ddd のまさに原点であり もう最も重要な出発点なんです原点はい 一見するとまあ厳しい言葉に聞こえるかもしれないんですけどこれは開発者への非難とかでは 全くなくて方法 むしろ誠実さの表れと捉えるべきなんですよね私たちはその プロのソフトウェア開発者ですけど会計のプロでも物流のプロでもない まあそうですよねその道の専門家ではないっていうこの謙虚な自己認識 これが良いソフトウェアを作るための第一歩になるんです なるほど無知であることをまず認めるところからその通りです だからこそ開発っていう行為は単に行動を書く作業じゃないんですよ 本質的には学習のプロセスそのものになるんです 会計システム作るなら経理を学びまし物流システム作るなら 貨物の流れを学ぶはいはい ddd が目指すのはその学習を通じて得た専門家の知識をいかに正確にそしてビジネスに とって本当に価値ある形でソフトウェアっていう成果物に反映させるか ということなんです学習のプロセスですか そこで資料に出てくるのが知識を高度へっていうキーフレーズですよね a ただ知識といってもなんか無限にありますよね 例えば資料にある物流システムの例だとどこまで知る必要があるんでしょう トラックのエンジンの仕組みとかそういうレベルまでああ良い質問ですね そこがまさにこのプロセスの最初の関門

でありDDDの面白さでもあるんです 答えはその知識がビジネスの価値に直結するかどうかで判断するということなんです DDDではこの知識の都社選択をものすごく重要視します ビジネス価値に直結するかですか 例えばですね物流システムでトラック1台にどれくらいの荷物が詰めるか 月採用量とか はいそれは大事ですね あと一度の給油でどれくらい走れるかっていう燃費の情報 これは配送計画を立てる上でも絶対に欠かせない非常に価値の高い知識です でも一方でトラックという言葉の語源はラテン語のトロックスであるっていう 知識 これ雑学としては面白いかもしれないですけど システムの目的達成には何の貢献もしない まあそうですねこれは価値のない知識と判断するわけです なるほどその境界線を引く作業が重要なんだと はいでその境界線を引く作業こそがドメインの専門家と開発者が一番最初に やるべき最も重要な対話なんです ああこの対話を通じて選び抜かれた価値ある知識の集合体 それこそがソフトウェアが向き合うべき世界 ddd の言葉で言うところのドメインになるわけです ドメイン ドメイン ドモリーリですね 会計システムなら経理の領域物量システムなら輸送の領域みたいな まさしくそしてこのドメインを主役にするというのがドメイン駆動設計の名の由来です はい ただこれが優は優しいでして開発の現場ではしばしばこの主役がなんか別のものにすり 変わっちゃうことがあるんですすり変わってしまうどういうことでしょう 資料にピカピカのハンマーは見るものすべてを釘に変えてしまうっていう面白い比喩はあり ましたけどこれですか ええまさにそれですこれは開発者なら誰しも経験があるすごく的確な比喩ですよねはい 私たち開発者って新しい技術とかフレームワークが大好きなんですよ 好きですねそれがピカピカのハンマーです でその新しいハンマーを手に入れると何でもかんでも叩いてみたくなる つまり本来解決すべきユーザーの問題そっちのけでこの新技術をどう使うか っていうこう技術中心の思考に陥ってしまう危険があるんです 耳が痛い開発者の方も多いかもしれないですね なんか技術の検証が目的になっちゃってユーザーが置き去りになるパターン そうなんですよ ddd はそういう技術指向の罠を避けてソフトウェア開発

開発における当たり前のこと、つまりユーザーが抱える問題と真摯に向き合うという本質に立ちかえるための、いわば哲学であり実践的な手法群なんです。 面白いですね。そのユーザーの問題と向き合うっていう当たり前をチーム全員が同じように理解し続けるには、何か共通の地図みたいなものが必要になりそうですけど。 ええ。 それがDDDでいうところのドメインモデルというものに当たるんでしょうか。 素晴らしい。まさにその通りです。そこが次の重要なステップになります。 専門家と開発者が対話して得た知識って、頭の中にあるだけだと共有できないし、すぐ形を失っちゃいますよね。 そこで、その知識を構造化して、誰もが見える形にした共通の地図、それがドメインモデルなんです。 ドメインというと、ちょっと抽象的で難しく聞こえますね。 確かに少しややこしい概念ですが、ここが肝心なところで、資料にあるペンの例がすごくわかりやすいので、それで説明しましょうか。 お願いします。 ここに1本のペンがあるとします。これをどうモデル化するかは、それを見る人の立場、つまりドメインによって全く異なります。 立場によってですか。 はい。例えば小説家にとってのペンって何でしょう。多分、滑らかに文字が書ける道具っていう側面が一番重要ですよね。 ええ、書き心地とか。 そうです。インクの種類とかがモデルの中心になる。一方で文房具店の店長にとってのペンはどうか。 ああ。 こっちは商品としての側面が重要です。つまり価格、在庫数、銘柄みたいな情報がモデルの中心になるはずです。 なるほど。 同じ1本のペンでも、ドメインが違えば切り取るべき現実の側面、つまり抽象化の仕方が全く違うわけです。 なるほど。小説家にペンの在庫数の話をしても意味がないし、店長に書き心地の詩的な表現を伝えても、まあ商売には繋がらない。 そうなんです。 当たり前といえば当たり前ですけど、ソフトウェア設計でこの視点が抜き落ちることがあると。 その通りです。なので、今これを聞いているあなたに問いかけたいんですが、今作っているソフトウェアのモデルは、本当にユーザーのドメインを正しく反映しているでしょうか?と。 うーん。 もしかしたら、開発者の都合のいいように、あるいは技術的な観点だけで世界を切り取ってしまってはいないでしょうか? なるほど。では、そのようにして作られた概念図であるドメインモデルは、実際のプログラミングコードとはどう繋がっていくんですか? 地図だけあっても目的地にはつけないですよね。 ええ、そこがドメインモデルとドメインオブジェクトの関係。

ですオブジェクトドメインモデルはいわば我々のこれから進むべき領域を描いた地図です その地図に描かれた地形とか街を実際に高度で表現してその世界を動かすための 乗り物や道具にあたるものこれがドメインオブジェクトなんです あーならば道地図モデルがないとどんな乗り物オブジェクトを作ればいいかわからないと そういうことですということは現実世界で何か変化が起きたらまず地図である ドメインモデルを更新してそれから乗り物であるドメインオブジェクトを修正していく という流れになるわけですね基本的にはその通りです でもここがすごく面白い点でその逆もまた頻繁に起こるんですよ 逆も資料ではこれをイテレーティブ つまり反復的な開発と呼んでいます 実際に乗り物つまりコードを書いてみるとあれこの地図の描き方だと道が繋がら ないなぁとか あーはいはいこの川を渡るには橋が必要だと初めて気づいたみたいな発見があるんです なるほど実装してみて初めてわかることがあると その実装からのフィードバックが今度は地図であるドメインモデルをより正確なものに更新させて 引いては我々のドメインそのものへの理解を深めることにもつながるんです つまりドメインの世界とコードの世界がドメインモデルを介して互いに影響を与え合いながら 共に進化していくこの双方向の対話こそが ddd のプロセスの確信なんです 一方通行じゃないんですね現実をコードに移し取るだけじゃなくて コードを書くことが現実の理解を深めることにもなると はいこれは開発者にとってすごく創造的でやりがいのあるプロセスに聞こえます ただその一方で ddd は実践が難しいという声もよく聞きますよね あーそうですねなぜなんでしょうか正直なところ簡単な道のりではないです 一つは今日お話ししただけでもドメインモデルオブジェクトとか まあ多くの概念や専門用語が出てきますよねそれには学習コストがかかります でもう一つより大きな障壁はこれが開発者だけで完結する話ではないっていう点です あードメインの専門家つまり実際の業務を行っている人たちを巻き込む必要があるからですね はい ドメインの専門家は日々の業務ですごく忙しいですし 開発者と専門家が円滑に対話するための共通言語を築くのにも時間がかかります ここはもう組織的な協力とか文化がないと個人の努力だけではどうにもならない という

になりがちですねでは ddd は大規模な組織改革でもしない限り導入は不可能みたいな話なんでしょうか 資料では批判することはないとも書かれてますがそこがすくいです ddd は巨大な一つの方法論であると同時に個別の実践的なテクニック まあプラクティスの集合体でもあるんですはい なのですべてを完璧に導入しようとしなくても 例えばドメインの重要な概念をコード上で表現する 値オブジェクトとかエンティティといったパターンこれは開発者個人の裁量でも今のプロジェクトに 少しずつ取り入れていくことが可能なんです なるほどそこから始めて少しずつ理解と適用の範囲を広げていくのが現実的な アプローチでしょうね できることから始めるとそしてもう一つ大きな疑問があります この ddd という考え方提唱されたのは2003年頃と決して新しいものではないですよね そうですそれがなぜ今20年以上経ってからこれほどまでに再注目されているんでしょうか そこに現代のソフトウェア開発が直面しているすごく根深い課題が凝縮されているんです 資料で使われている比喩の本当に秀逸なのでぜひ紹介させてください それは昔ながらの開発スタイルを片道ロケットに例えるものなんです 片道ロケットですかなんだかちょっと物悲しい響きですね とにかく早く市場にサービスを打ち上げることが最優先 一度打ち上げたらもう地球には帰ってこれない つまり将来の使用変更とか機能追加といった 帰りの燃料はほとんど積んでないんです もし修正が必要になってもそれは場当たり的な継ぎはぎだらけになっていく なるほどまずは市場での生存競争に勝つことが一条命題だった時代のある意味で 合理的な開発スタイルだとも言えます なるほどそれに対して現代で求められているのは飛行機の安定運用だと その通りです飛行機は片道ロケットと違って何度も離落陸を繰り返して乗客を 安全に運び続けますよね a つまり一度作って終わりじゃなくて長期的な運用を前提としてビジネス環境の変化 に合わせて柔軟に航路を変えたり 新しい座席を追加したりできるソフトウェアが求められている はいはいあの片道ロケットの継ぎはぎ運用に疲弊しきった多くの開発者たちがこの 飛行機の安定運用という理想にたどり着いてその実現方法を探し求めた結果 ドメイン駆動設計という古典に

光を当てたというわけなんです ということはもしかしてDDDの本当の価値が分かるのって システムを作った直後じゃなくて 数年後にすみません ここの仕様を大きく変更してくださいって 頼まれたときということなんでしょうか まさにおっしゃる通りです ドメイン駆動設計の進化は ソフトウェアが変化に直面したときにこそ 最大限に発揮されます ドメインの核となるモデルがしっかり構築されていれば 変更の影響範囲が明確になって 安全かつ迅速に修正を加えられる 初期開発のスピードだけを見れば 少し重厚に感じるかもしれません でも数年後数十年後を見据えたとき その初期投資は必ず報われるという確信が 今の多くの開発者の間で広がっているんだと思います いやー非常に納得感がある話でした では今回の話をまとめてみましょうか はい 今の話ではなくて ソフトウェアが向き合うべき領域 つまりドメインの知識を深く正しく理解して 選び抜かれたその知識をコードの中心に据えるという ある意味で非常に当たり前な哲学だということですね はい 素晴らしいまとめです 技術はあくまでその哲学を実現するための手段にすぎないということです そして資料で紹介されている 担いオブジェクトとかエンティティ リポジトリといった具体的な設計パターンは その哲学を実践するためのいわば道具箱の中身なのだと そういう理解でよろしいですかね その通りです そして重要なのは それらの道具がなぜ必要なのかという背景にある哲学を理解することなんです そうすればどの道具をいつどう使うべきかが見えてきます ありがとうございます では最後にこの話を聞いてくださっている あなたに一つ思考を深めるための問いを はい ドメイン駆動設計は当たり前のことを当たり前にやるためのプラクティスだと資料は締めくくっています ではあなたのソフトウェアにとっての そしてあなたのチームにとっての当たり前とは一体何でしょうか 今あなたのソフトウェアが解決しようとしている問題の本質 そのドメインに渦巻く知識の中で まだ高度に表現しきれていない 最も重要で最も当たり前なことは一体何だと思いますか まずはその一つを言葉にしてチームで共有してみることから 新しい設計そして新しい未来が始まるのかもしれないです