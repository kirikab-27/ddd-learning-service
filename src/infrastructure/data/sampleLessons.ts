import { Lesson, LessonTitle, MarkdownContent } from '@/domain/content/models';
import { LessonId } from '@/domain/shared';

// Lesson 1-1: なぜDDDが必要なのか
export const lesson1_1 = Lesson.create({
  id: LessonId.create('lesson-1-1'),
  title: LessonTitle.create('なぜDDDが必要なのか'),
  content: MarkdownContent.create(`
# なぜDDDが必要なのか

## 概要

このレッスンでは、DDDが解決しようとする問題と、DDDを採用するメリットについて学びます。
なぜ従来のソフトウェア開発アプローチでは複雑なビジネスロジックを扱うのが難しいのか、
そしてDDDがどのようにその課題を解決するのかを理解しましょう。

## ソフトウェア開発の課題

### 複雑なビジネスロジック

現代のソフトウェア開発では、ビジネスロジックが非常に複雑になることがあります。
例えば、ECサイトでは以下のような複雑なルールが存在します：

- 会員ランクによる割引率の違い
- 在庫状況に応じた注文制限
- 配送先による送料計算
- キャンペーン期間中の特別ルール

これらのルールが適切に整理されていないと、**スパゲッティコード**が生まれます。

\`\`\`typescript
// 悪い例：ビジネスルールが散在している
function processOrder(order, user, inventory) {
  let discount = 0;
  if (user.rank === 'gold') {
    discount = 0.1;
  } else if (user.rank === 'silver') {
    discount = 0.05;
  }
  // ...さらに多くの条件分岐が続く
}
\`\`\`

### 技術とビジネスの乖離

開発者が使う技術的な用語と、ビジネス側が使う用語が異なると、
コミュニケーションに齟齬が生まれます。

| ビジネス側の言葉 | 開発者の言葉 |
|----------------|------------|
| 「顧客」 | 「Userテーブル」 |
| 「注文を確定する」 | 「statusフラグを1にする」 |
| 「在庫を引き当てる」 | 「inventory -= quantity」 |

この乖離が大きくなると、ビジネス要件の誤解や実装ミスにつながります。

## DDDとは

**ドメイン駆動設計（Domain-Driven Design）** は、Eric Evansが2003年に提唱した
ソフトウェア設計手法です。

DDDの核心は：

> ソフトウェアの複雑さの根本原因は、**ドメイン（ビジネスの問題領域）** にある。
> したがって、ドメインを深く理解し、それをコードに反映させることが重要である。

### DDDの3つの柱

1. **ユビキタス言語**: ビジネスと開発で共通の言葉を使う
2. **モデル駆動設計**: ドメインモデルをコードの中心に据える
3. **境界づけられたコンテキスト**: 複雑さを適切な単位で分離する

## DDDのメリット

### 1. ビジネスと技術の共通理解

DDDでは、ビジネスエキスパートと開発者が同じ言葉（ユビキタス言語）を使います。

\`\`\`typescript
// DDDを適用した例：ビジネス用語がそのままコードに
class Order {
  confirm(): void {
    if (!this.canBeConfirmed()) {
      throw new OrderCannotBeConfirmedException();
    }
    this.status = OrderStatus.Confirmed;
  }
}
\`\`\`

### 2. 変更に強い設計

ドメインモデルを中心に設計することで、ビジネスルールの変更に柔軟に対応できます。

### 3. チームコミュニケーションの改善

共通言語があることで、要件定義の精度向上やコードレビューの効率化が実現します。

## まとめ

- **スパゲッティコード**や**ビジネスルールの散在**は、複雑なソフトウェア開発の大きな課題
- **技術とビジネスの乖離**は、コミュニケーションエラーや実装ミスを引き起こす
- **DDD**は、ドメインを中心に据えた設計手法で、これらの課題を解決する
- DDDにより、**共通理解**、**変更への強さ**、**コミュニケーション改善**が実現できる
`),
  order: 1,
});

// Lesson 1-2: ドメインエキスパートとの協業
export const lesson1_2 = Lesson.create({
  id: LessonId.create('lesson-1-2'),
  title: LessonTitle.create('ドメインエキスパートとの協業'),
  content: MarkdownContent.create(`
# ドメインエキスパートとの協業

## 概要

このレッスンでは、DDDにおけるドメインエキスパートとの協業について学びます。
なぜ協業が重要なのか、そして効果的なコミュニケーション手法について理解しましょう。

## ドメインエキスパートとは誰か

**ドメインエキスパート**とは、ビジネスドメインについて深い知識を持つ人のことです。
必ずしも「偉い人」や「肩書きのある人」ではありません。

ドメインエキスパートになりうる人：

| 役割 | 専門知識の例 |
|------|-----------|
| 営業担当者 | 顧客のニーズ、商談プロセス |
| カスタマーサポート | よくある問題、ユーザーの困りごと |
| 経理担当者 | 会計処理、請求ルール |
| 物流担当者 | 配送ルール、在庫管理 |

## なぜ協業が重要か

開発者がドキュメントを読んだだけでは、以下を把握できません：

- **暗黙のルール**: 「普通はこうする」という慣習
- **例外ケース**: 「でも、この場合は違う」というケース
- **優先度**: どのルールがより重要か
- **文脈**: なぜそのルールが存在するのか

## 効果的なコミュニケーション手法

### 1. イベントストーミング

**イベントストーミング**は、ビジネスプロセスを可視化するワークショップ手法です。

1. オレンジ色の付箋に「起きること（イベント）」を書く
2. 時系列に並べる
3. イベントを引き起こす「コマンド」と「アクター」を追加
4. 境界を見つけ、コンテキストを分離

### 2. ホワイトボードセッション

図を描きながらドメインエキスパートと対話する手法です。

### 3. プロトタイピング

実際に動くものを見せて、認識を合わせます。

## まとめ

- **ドメインエキスパート**は、ビジネスドメインの深い知識を持つ人
- 開発者だけでは**暗黙のルール**や**例外ケース**を把握できない
- **イベントストーミング**、**ホワイトボードセッション**、**プロトタイピング**が効果的
- 協業を通じて**ユビキタス言語**を構築し、コードに反映させる
`),
  order: 2,
});

// Lesson 1-3: ドメインモデルの役割
export const lesson1_3 = Lesson.create({
  id: LessonId.create('lesson-1-3'),
  title: LessonTitle.create('ドメインモデルの役割'),
  content: MarkdownContent.create(`
# ドメインモデルの役割

## 概要

このレッスンでは、DDDの中核となる「ドメインモデル」について学びます。
モデルとは何か、なぜ重要なのか、そしてどのように表現するのかを理解しましょう。

## モデルとは何か

**モデル**とは、現実世界の複雑さを目的に応じて簡略化した表現です。

モデルの例：
- **地図**: 現実の地形を2次元に簡略化
- **組織図**: 会社の構造を階層的に表現
- **ER図**: データベースの構造を表現

重要なのは、モデルは**現実の完全なコピーではない**ということです。

## ドメインモデルの目的

### 1. 複雑さの整理

ビジネスの複雑さを、理解可能なレベルに整理します。

\`\`\`typescript
// モデルあり：概念が整理されている
class Payment {
  constructor(
    private readonly order: Order,
    private readonly amount: Money,
    private readonly method: PaymentMethod
  ) {}

  execute(): PaymentResult {
    this.validateAmount();
    return this.method.process(this.amount);
  }
}
\`\`\`

### 2. コミュニケーションの基盤

ドメインモデルは、チーム全員が参照できる**共通の理解**を提供します。

### 3. 設計の指針

モデルがあることで、ロジックの配置や概念の分離が判断しやすくなります。

## モデルの表現方法

### 1. UML図

クラス図でドメインモデルを視覚化します。全体像を俯瞰でき、非エンジニアにも伝わりやすいです。

### 2. コード

コード自体がドメインモデルの最も正確な表現です。

\`\`\`typescript
class Order {
  private readonly id: OrderId;
  private items: OrderItem[];
  private status: OrderStatus;

  addItem(product: Product, quantity: number): void {
    if (this.status !== OrderStatus.Draft) {
      throw new CannotModifyConfirmedOrderError();
    }
    const item = OrderItem.create(product, quantity);
    this.items.push(item);
  }

  confirm(): void {
    if (this.items.length === 0) {
      throw new EmptyOrderCannotBeConfirmedError();
    }
    this.status = OrderStatus.Confirmed;
  }
}
\`\`\`

### 3. 用語集（ユビキタス言語）

ドメインの言葉を定義した辞書です。誰でも読め、認識のズレを防ぎます。

## まとめ

- **モデル**は現実を目的に応じて簡略化した表現
- **ドメインモデル**はビジネスドメインの概念、関係、ルールを表現する
- ドメインモデルは**複雑さの整理**、**コミュニケーションの基盤**、**設計の指針**として機能する
- 表現方法には**UML図**、**コード**、**用語集**があり、それぞれ補完し合う
- モデルは**継続的に改善**されるべきもの
`),
  order: 3,
});

export const chapter1Lessons = [lesson1_1, lesson1_2, lesson1_3];
